<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhasmShop | Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; margin: 0; background: #0a0e17; color: white; }
        
        /* Ø®Ù„ÙÙŠØ© ÙØ®Ù…Ø© Ù…ØªØ­Ø±ÙƒØ© */
        .animated-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(45deg, #0f172a, #1e293b, #081321);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% {background-position: 0% 50%} 50% {background-position: 100% 50%} 100% {background-position: 0% 50%} }

        /* Ø¥Ø¹Ù„Ø§Ù† 3D */
        .marquee-3d {
            background: rgba(30, 64, 175, 0.9); color: #fbbf24; padding: 12px 0;
            transform: perspective(500px) rotateX(5deg); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden; border-bottom: 2px solid #fbbf24; font-weight: 900;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px;
        }

        .product-card {
            transition: 0.4s; border: 1px solid rgba(255,255,255,0.1);
        }
        .product-card:hover { transform: translateY(-10px); border-color: #fbbf24; background: rgba(255,255,255,0.1); }
        
        .sidebar { transition: 0.5s; z-index: 100; }
    </style>
</head>
<body>

    <div class="animated-bg"></div>

    <div class="marquee-3d">
        <marquee behavior="scroll" direction="right" scrollamount="7">
            ğŸ”¥ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø¨Ø±ÙˆÙ†Ø²ÙŠØŒ ÙØ¶ÙŠ (3%)ØŒ Ø°Ù‡Ø¨ÙŠ (6%)ØŒ Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ (9%)ØŒ ÙˆÙ…Ø§Ø³ÙŠ (12%)! | Ø´Ø­Ù† ÙÙˆØ±ÙŠ ÙˆØ¢Ù…Ù† Ø¹Ø¨Ø± Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† ğŸ”¥
        </marquee>
    </div>

    <div id="sidebar" class="fixed top-0 right-0 h-full w-72 bg-slate-900/95 backdrop-blur-xl transform translate-x-full sidebar p-6 border-r border-white/10 shadow-2xl">
        <button onclick="toggleSidebar()" class="text-white text-3xl mb-10"><i class="fas fa-times-circle"></i></button>
        <div class="text-center mb-10 border-b border-white/10 pb-6">
            <p class="text-gray-400 text-xs mb-2">Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­ÙØ¸Ø©</p>
            <p id="sideWalletID" class="text-2xl font-black text-yellow-400 tracking-[5px]">------</p>
        </div>
        <nav class="space-y-6 text-lg">
            <a href="#" class="flex items-center gap-4 hover:text-yellow-400 transition"><i class="fas fa-home w-8"></i> Ø§Ù„Ø±Ø¦ÙŠØ³Ø©</a>
            <a href="#" class="flex items-center gap-4 hover:text-yellow-400 transition"><i class="fas fa-history w-8"></i> Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
            <a href="#" class="flex items-center gap-4 hover:text-yellow-400 transition"><i class="fas fa-user-check w-8"></i> ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</a>
            <button onclick="logout()" class="flex items-center gap-4 text-red-500 mt-10"><i class="fas fa-power-off w-8"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </nav>
    </div>

    <div class="max-w-md mx-auto min-h-screen pb-20">
        <header class="flex justify-between items-center p-6 sticky top-0 z-40 bg-slate-900/50 backdrop-blur-md">
            <button onclick="toggleSidebar()" class="text-2xl text-yellow-400"><i class="fas fa-bars-staggered"></i></button>
            <h1 class="text-2xl font-black tracking-tighter text-white">KHASM<span class="text-yellow-400">SHOP</span></h1>
            <div id="rankBadge" class="bg-yellow-400 text-black px-4 py-1 rounded-full text-[10px] font-black uppercase">ØªØ­Ù…ÙŠÙ„...</div>
        </header>

        <main class="p-4">
            <div class="glass-card p-4 mb-6 flex justify-between items-center border-l-4 border-yellow-400">
                <div>
                    <p class="text-[10px] text-gray-400">ØªØªØ¨Ø¹ Ø¢Ø®Ø± Ø·Ù„Ø¨</p>
                    <p id="orderStatus" class="text-sm font-bold">ğŸ” Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
                <div class="p-3 bg-yellow-400/10 rounded-2xl"><i class="fas fa-truck-fast text-yellow-400 text-xl"></i></div>
            </div>

            <div class="glass-card p-6 mb-8 relative overflow-hidden">
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-xs text-gray-400 uppercase tracking-widest">Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©</p>
                            <h2 class="text-4xl font-black text-white mt-1"><span id="balance">0.00</span> <span class="text-sm text-yellow-400">SDG</span></h2>
                        </div>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/5c/Amazon_Lambda_architecture_logo.svg" class="w-10 opacity-20">
                    </div>
                    <div class="flex justify-between items-center text-xs">
                        <span id="nextRankText" class="text-gray-400">Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ÙØ¶ÙŠ</span>
                        <span id="progressText" class="font-bold text-yellow-400">0/900 UC</span>
                    </div>
                    <div class="w-full bg-white/10 h-1.5 rounded-full mt-2">
                        <div id="progressBar" class="bg-yellow-400 h-full w-0 transition-all duration-1000"></div>
                    </div>
                </div>
            </div>

            <div id="adminPanel" class="hidden glass-card p-6 mb-8 border-2 border-yellow-400/30">
                <h3 class="text-yellow-400 font-black mb-4 flex items-center gap-2 text-lg">
                    <i class="fas fa-shield-alt"></i> Ø´Ø­Ù† Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
                </h3>
                <input id="targetWalletID" type="text" maxlength="6" placeholder="Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø²Ø¨ÙˆÙ†" class="w-full mb-3 p-4 rounded-2xl bg-white/5 border border-white/10 text-center font-bold text-white outline-none focus:border-yellow-400">
                <input id="chargeAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (SDG)" class="w-full mb-4 p-4 rounded-2xl bg-white/5 border border-white/10 text-center font-bold text-white outline-none focus:border-yellow-400">
                <button onclick="confirmCharge()" class="w-full bg-yellow-400 text-black font-black py-4 rounded-2xl hover:scale-95 transition">ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ âœ…</button>
            </div>

            <h3 class="text-xl font-black mb-6 flex items-center gap-3">
                <span class="w-2 h-8 bg-yellow-400 rounded-full"></span>
                Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ù„ÙƒÙŠ
            </h3>
            <div id="productList" class="grid grid-cols-2 gap-4">
                </div>
        </main>
    </div>

    <div id="loginOverlay" class="fixed inset-0 z-[200] bg-slate-900 flex items-center justify-center p-6 hidden">
        <div class="glass-card w-full max-w-sm p-8 text-center border-white/20">
            <h2 class="text-3xl font-black mb-8 text-white">Ø¯Ø®ÙˆÙ„ <span class="text-yellow-400">Ø§Ù„Ù…ØªØ¬Ø±</span></h2>
            <div class="space-y-4">
                <button onclick="loginGoogle()" class="w-full bg-white text-black p-4 rounded-2xl font-bold flex items-center justify-center gap-3">
                    <img src="https://www.google.com/favicon.ico" class="w-5"> Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„
                </button>
                <div class="text-gray-500 py-2 text-sm">Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                <input id="emailInput" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 text-white outline-none">
                <input id="passInput" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full p-4 rounded-2xl bg-white/5 border border-white/10 text-white outline-none">
                <button onclick="loginEmail()" class="w-full bg-yellow-400 text-black p-4 rounded-2xl font-black">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, where, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC0jzecEwKgHpxHpTi8Y-_bwwfzVdtgf3E",
            authDomain: "khasmshop.firebaseapp.com",
            projectId: "khasmshop",
            storageBucket: "khasmshop.firebasestorage.app",
            messagingSenderId: "238182001615",
            appId: "1:238182001615:web:d77391030a40a481b440ba"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const admins = ["mohnadyasir43@gmail.com", "muhammedaltaj111@gmail.com", "mhmdfthu98@gmail.com"];
        let userData = null;

        const rawProducts = [
            { id: 1, name: "60 Ø´Ø¯Ø© Ø¨Ø¨Ø¬ÙŠ", uc: 60, price: 4000 },
            { id: 2, name: "325 Ø´Ø¯Ø© Ø¨Ø¨Ø¬ÙŠ", uc: 325, price: 18500 },
            { id: 3, name: "660 Ø´Ø¯Ø© Ø¨Ø¨Ø¬ÙŠ", uc: 660, price: 36000 },
            { id: 4, name: "1800 Ø´Ø¯Ø© Ø¨Ø¨Ø¬ÙŠ", uc: 1800, price: 95000 }
        ];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('loginOverlay').classList.add('hidden');
                if (admins.includes(user.email.toLowerCase())) document.getElementById('adminPanel').classList.remove('hidden');
                
                const ref = doc(db, "wallets", user.uid);
                const snap = await getDoc(ref);
                if (snap.exists()) {
                    userData = snap.data();
                } else {
                    userData = { balance: 0, totalUC: 0, rank: "Ø¨Ø±ÙˆÙ†Ø²ÙŠ", walletID: Math.floor(100000 + Math.random() * 900000).toString() };
                    await setDoc(ref, userData);
                }
                updateUI();
            } else {
                document.getElementById('loginOverlay').classList.remove('hidden');
            }
        });

        function getRankInfo(uc) {
            if (uc >= 7400) return { name: "Ù…Ø§Ø³ÙŠ", disc: 0.12, next: "Ø§Ù„Ù‚Ù…Ø©", target: 7400 };
            if (uc >= 4400) return { name: "Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ", disc: 0.09, next: "Ù…Ø§Ø³ÙŠ", target: 7400 };
            if (uc >= 2400) return { name: "Ø°Ù‡Ø¨ÙŠ", disc: 0.06, next: "Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ", target: 4400 };
            if (uc >= 900) return { name: "ÙØ¶ÙŠ", disc: 0.03, next: "Ø°Ù‡Ø¨ÙŠ", target: 2400 };
            return { name: "Ø¨Ø±ÙˆÙ†Ø²ÙŠ", disc: 0, next: "ÙØ¶ÙŠ", target: 900 };
        }

        function updateUI() {
            const info = getRankInfo(userData.totalUC);
            document.getElementById('balance').innerText = userData.balance.toLocaleString();
            document.getElementById('sideWalletID').innerText = userData.walletID;
            document.getElementById('rankBadge').innerText = info.name;
            document.getElementById('nextRankText').innerText = `Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${info.next}`;
            document.getElementById('progressText').innerText = `${userData.totalUC}/${info.target} UC`;
            document.getElementById('progressBar').style.width = `${Math.min((userData.totalUC/info.target)*100, 100)}%`;

            const list = document.getElementById('productList');
            list.innerHTML = "";
            rawProducts.forEach(p => {
                const finalPrice = p.price * (1 - info.disc);
                list.innerHTML += `
                    <div class="product-card glass-card p-5 text-center">
                        <p class="text-[10px] text-gray-400 mb-1">${p.name}</p>
                        <p class="text-xl font-black text-white">${finalPrice.toLocaleString()} <span class="text-[10px] text-yellow-400">SDG</span></p>
                        ${info.disc > 0 ? `<p class="text-[9px] text-red-500 line-through">${p.price}</p>` : ''}
                        <button onclick="buyProduct(${p.price}, ${p.uc})" class="w-full bg-yellow-400 text-black text-[10px] font-black py-2 rounded-xl mt-4">Ø´Ø­Ù† ÙÙˆØ±ÙŠ</button>
                    </div>`;
            });
        }

        window.buyProduct = async (price, uc) => {
            if (userData.balance < price) return alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ! ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ù„Ø´Ø­Ù† Ù…Ø­ÙØ¸ØªÙƒ.");
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ØŸ")) {
                const ref = doc(db, "wallets", auth.currentUser.uid);
                await updateDoc(ref, { balance: increment(-price), totalUC: increment(uc) });
                document.getElementById('orderStatus').innerText = "â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...";
                setTimeout(() => { document.getElementById('orderStatus').innerText = "âœ… ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­!"; location.reload(); }, 3000);
            }
        };

        window.confirmCharge = async () => {
            const id = document.getElementById('targetWalletID').value;
            const amount = parseFloat(document.getElementById('chargeAmount').value);
            if (id.length !== 6 || isNaN(amount)) return alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");
            if (confirm(`Ø´Ø­Ù† ${amount} SDG Ù„Ù„Ù…Ø­ÙØ¸Ø© ${id}ØŸ`)) {
                const q = query(collection(db, "wallets"), where("walletID", "==", id));
                const snap = await getDocs(q);
                if (snap.empty) return alert("Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
                await updateDoc(doc(db, "wallets", snap.docs[0].id), { balance: increment(amount) });
                alert("ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­!");
            }
        };

        window.loginGoogle = () => signInWithPopup(auth, new GoogleAuthProvider());
        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('translate-x-full');
        window.logout = () => signOut(auth).then(() => location.reload());
    </script>
</body>
        </html>

