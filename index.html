<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø®ØµÙ… | KHASM SHOP</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* 1. Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠ ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© */
        :root {
            --gold: #f59e0b;
            --gold-glow: rgba(245, 158, 11, 0.3);
            --bg-deep: #050505;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-deep);
            color: #ffffff;
            margin: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(245, 158, 11, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(245, 158, 11, 0.05) 0%, transparent 40%);
            background-attachment: fixed;
            min-height: 100vh;
        }

        /* Ù†Ø³ÙŠØ¬ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ† Ù„Ù„ÙØ®Ø§Ù…Ø© */
        .carbon-texture {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
            opacity: 0.12;
            z-index: -1;
            pointer-events: none;
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
        .royal-card {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 28px;
            padding: 22px;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .royal-card:hover {
            border-color: var(--gold);
            box-shadow: 0 15px 40px rgba(0,0,0,0.6), 0 0 20px var(--gold-glow);
            transform: translateY(-5px);
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ© */
        .khasm-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #b45309 100%);
            color: #000;
            font-weight: 900;
            border-radius: 16px;
            padding: 16px;
            width: 100%;
            cursor: pointer;
            border: none;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
        }

        .khasm-btn:active { transform: scale(0.95); }

        /* Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© */
        .status-btn {
            padding: 10px 5px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 800;
            flex: 1;
            text-align: center;
        }
        .btn-complete { background: #064e3b; color: #34d399; }
        .btn-pending { background: #1e3a8a; color: #60a5fa; }
        .btn-error { background: #7f1d1d; color: #f87171; }

        /* Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„ØµÙØ­Ø§Øª */
        .page { display: none; animation: slideUp 0.6s ease-out forwards; }
        .page.active { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        input, select {
            background: rgba(0,0,0,0.7) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            color: #fff !important;
            border-radius: 14px;
            padding: 15px;
            width: 100%;
            outline: none;
        }

        .nav-link { opacity: 0.4; transition: 0.3s; }
        .nav-link.active { opacity: 1; color: var(--gold); transform: translateY(-3px); }
    </style>
</head>
<body class="pb-32">
    <div class="carbon-texture"></div>

    <div id="loginOverlay" class="fixed inset-0 bg-[#050505] z-[9999] flex flex-col items-center justify-center p-10 text-center">
        <h1 class="text-8xl font-black italic text-amber-500 mb-2 drop-shadow-[0_0_20px_rgba(245,158,11,0.4)]">KHASM</h1>
        <p class="text-gray-500 tracking-[12px] uppercase text-[10px] mb-12">Empire of Gaming</p>
        <button id="loginBtn" class="bg-white text-black px-14 py-5 rounded-full font-black flex items-center gap-4 hover:bg-amber-500 transition-all shadow-2xl">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="22">
            Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±
        </button>
    </div>

    <header class="p-6 flex justify-between items-center sticky top-0 bg-black/80 backdrop-blur-xl z-50 border-b border-white/5">
        <div>
            <h2 class="text-2xl font-black italic text-amber-500">KHASM SHOP</h2>
            <p id="userNameDisplay" class="text-[9px] text-gray-500 font-bold uppercase mt-1"></p>
        </div>
        <div class="flex items-center gap-3">
            <div class="bg-amber-500/10 px-4 py-2 rounded-2xl border border-amber-500/20 text-center min-w-[70px]">
                <span id="starsCount" class="text-2xl font-black text-amber-500 block leading-none">0</span>
                <span class="text-[8px] font-bold text-amber-200/50 uppercase">Ù†Ù‚Ø·Ø©</span>
            </div>
            <button onclick="logout()" class="text-red-500/50 hover:text-red-500 transition"><i class="fas fa-power-off text-xl"></i></button>
        </div>
    </header>

    <main class="p-5 max-w-2xl mx-auto space-y-8">
        
        <section id="page-shop" class="page active space-y-12">
            <div class="royal-card bg-gradient-to-l from-amber-900/20 to-transparent border-r-4 border-amber-500">
                <h3 class="text-xl font-black mb-1">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ğŸ‘‘</h3>
                <p class="text-[10px] text-gray-400 font-bold">ÙƒÙ„ 30 Ù†Ù‚Ø·Ø© ØªÙ…Ù†Ø­Ùƒ 60 Ø´Ø¯Ø© Ù…Ø¬Ø§Ù†ÙŠØ©. Ø§Ø´Ø­Ù† Ø§Ù„Ø¢Ù† ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø·!</p>
            </div>

            <div class="space-y-10">
                <div><h3 class="text-lg font-black mb-6 flex items-center gap-3"><i class="fas fa-bolt text-amber-500"></i> Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h3><div id="list-direct" class="grid gap-5"></div></div>
                <div><h3 class="text-lg font-black mb-6 flex items-center gap-3"><i class="fas fa-id-card text-amber-500"></i> Ø´Ø­Ù† Ø§Ù„Ø£ÙŠØ¯ÙŠ</h3><div id="list-id" class="grid gap-5"></div></div>
                <div><h3 class="text-lg font-black mb-6 flex items-center gap-3"><i class="fas fa-gem text-amber-500"></i> Ø§Ù„Ø­Ø²Ù… ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h3><div id="list-subs" class="grid gap-5"></div></div>
            </div>
        </section>

        <section id="page-rewards" class="page text-center pt-10">
            <div class="royal-card p-12 border-amber-500/20">
                <i class="fas fa-crown text-7xl text-amber-500 mb-8"></i>
                <h2 class="text-3xl font-black mb-10">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·</h2>
                <div class="bg-black/60 p-8 rounded-[40px] border border-white/5 mb-10">
                    <p class="text-[10px] text-gray-500 font-bold uppercase mb-2">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                    <span id="pointsLarge" class="text-7xl font-black text-amber-500">0</span>
                </div>
                <input id="pid-redeem" type="number" placeholder="ID Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø³ØªÙ„Ù…" class="text-center mb-6">
                <button onclick="redeemPoints()" class="khasm-btn text-xl">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ 30 Ù†Ù‚Ø·Ø© Ø¨Ù€ 60 UC âœ¨</button>
            </div>
        </section>

        <section id="page-orders" class="page space-y-6">
            <h3 class="text-xl font-black border-r-4 border-amber-500 pr-4">ØªØªØ¨Ø¹ Ø´Ø­Ù†Ø§ØªÙƒ</h3>
            <div id="user-orders" class="space-y-4"></div>
        </section>

        <section id="page-admin" class="page space-y-10">
            <div class="flex justify-between items-center border-b border-white/10 pb-6">
                <h2 class="text-2xl font-black text-amber-500">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h2>
                <span class="text-[10px] bg-red-500/20 text-red-500 px-3 py-1 rounded-full font-bold">Ø¥Ø¯Ø§Ø±Ø©</span>
            </div>

            <div class="space-y-4">
                <h3 class="text-sm font-black text-gray-400 uppercase tracking-widest">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                <div id="adm-orders-view" class="grid gap-4"></div>
            </div>

            <div id="admin-prices-control" class="hidden pt-10 border-t border-white/10">
                <h3 class="text-lg font-black mb-6 text-green-500">Ø¥Ø¶Ø§ÙØ© Ø­Ø²Ù… Ù„Ù„Ù…ØªØ¬Ø±</h3>
                <div class="royal-card space-y-5">
                    <select id="add-type"><option value="direct">Ø´Ø­Ù† Ù…Ø¨Ø§Ø´Ø±</option><option value="id">Ø´Ø­Ù† Ø¢ÙŠØ¯ÙŠ</option><option value="subs">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</option></select>
                    <input id="add-a" type="text" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© (Ù…Ø«Ù„: 660 UC)">
                    <input id="add-p" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± (SDG)">
                    <button onclick="pushNewPkg()" class="khasm-btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø²Ù…Ø© Ù„Ù„Ù…ØªØ¬Ø± â•</button>
                </div>
                <div id="adm-pkgs-list" class="mt-8 space-y-2 opacity-40"></div>
            </div>
        </section>
    </main>

    <div id="ratingPopup" class="fixed inset-0 bg-black/95 z-[10000] hidden flex items-center justify-center p-6">
        <div class="royal-card p-10 w-full max-w-sm text-center">
            <h3 class="text-2xl font-black mb-6 text-amber-500">ÙƒÙŠÙ ÙƒØ§Ù† Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù†Ø§ØŸ</h3>
            <div class="flex justify-center gap-4 text-4xl mb-12" id="stars-input">
                <i class="fas fa-star text-gray-800 cursor-pointer" onclick="setStar(1)"></i>
                <i class="fas fa-star text-gray-800 cursor-pointer" onclick="setStar(2)"></i>
                <i class="fas fa-star text-gray-800 cursor-pointer" onclick="setStar(3)"></i>
                <i class="fas fa-star text-gray-800 cursor-pointer" onclick="setStar(4)"></i>
                <i class="fas fa-star text-gray-800 cursor-pointer" onclick="setStar(5)"></i>
            </div>
            <button onclick="submitRating()" class="khasm-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ù„ÙƒÙŠ ğŸ‘‘</button>
        </div>
    </div>

    <nav class="fixed bottom-6 inset-x-6 h-22 bg-black/90 backdrop-blur-3xl border border-white/10 rounded-[35px] flex justify-around items-center z-50 shadow-2xl px-4">
        <button onclick="changePage('shop')" id="n-shop" class="nav-link active flex flex-col items-center gap-2 text-[10px] font-black uppercase"><i class="fas fa-store text-2xl"></i>Ø§Ù„Ù…ØªØ¬Ø±</button>
        <button onclick="changePage('rewards')" id="n-rewards" class="nav-link flex flex-col items-center gap-2 text-[10px] font-black uppercase"><i class="fas fa-gem text-2xl"></i>Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</button>
        <button onclick="changePage('orders')" id="n-orders" class="nav-link flex flex-col items-center gap-2 text-[10px] font-black uppercase"><i class="fas fa-history text-2xl"></i>Ø·Ù„Ø¨Ø§ØªÙŠ</button>
        <button id="n-admin" onclick="changePage('admin')" class="nav-link hidden flex flex-col items-center gap-2 text-[10px] font-black uppercase text-red-500"><i class="fas fa-user-shield text-2xl"></i>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, set, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyC0jzecEwKgHpxHpTi8Y-_bwwfzVdtgf3E", authDomain: "khasmshop.firebaseapp.com", databaseURL: "https://khasmshop-default-rtdb.firebaseio.com", projectId: "khasmshop" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯
        const MASTER = "mhmdfthu98@gmail.com";
        const STAFF = [
            "mohnadyasir43@gmail.com", 
            "muhammedaltaj111@gmail.com" // Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¯Ø§Ø±ÙŠØ©
        ];
        
        let user = null;
        let lastCount = 0;
        let ratingKey = "";
        let ratingValue = 5;

        document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, u => {
            if(u) {
                user = u;
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('userNameDisplay').innerText = u.displayName;
                const email = u.email.toLowerCase();
                if(email === MASTER || STAFF.includes(email)) {
                    document.getElementById('n-admin').classList.remove('hidden');
                    if(email === MASTER) document.getElementById('admin-prices-control').classList.remove('hidden');
                }
                syncData();
            }
        });

        window.changePage = id => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-'+id).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('n-'+id).classList.add('active');
        };

        window.updateStatus = (key, uid, amt, status) => {
            update(ref(db, `orders/${key}`), { status: status });
            if(status === 'âœ… Ù…ÙƒØªÙ…Ù„ (ØªÙ… Ø§Ù„Ø´Ø­Ù†)') {
                get(ref(db, `users/${uid}/stars`)).then(snap => {
                    const current = snap.val() || 0;
                    const gain = parseInt(amt) >= 60 ? Math.floor(parseInt(amt)/30) : 1;
                    set(ref(db, `users/${uid}/stars`), current + (gain < 1 ? 1 : gain));
                });
            }
        };

        window.sendOrder = (amt, price, key) => {
            const pid = document.getElementById('pid-'+key).value;
            const ag = document.getElementById('agent-'+key);
            if(!pid || pid.length < 5) return alert("Ø£Ø¯Ø®Ù„ ID Ù„Ø§Ø¹Ø¨ ØµØ­ÙŠØ­!");

            const order = {
                userName: user.displayName, userId: user.uid, amount: amt, price: price, 
                pid: pid, agent: ag.options[ag.selectedIndex].text, status: 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', date: new Date().toLocaleString('ar-EG')
            };

            push(ref(db, 'orders'), order).then(() => {
                const msg = `ğŸ‘‘ *Ø·Ù„Ø¨ Ø´Ø­Ù† Ù…Ù† KHASM SHOP*\n\nğŸ‘¤ *Ø§Ù„Ø²Ø¨ÙˆÙ†:* ${user.displayName}\nğŸ’ *Ø§Ù„ÙƒÙ…ÙŠØ©:* ${amt}\nğŸ’° *Ø§Ù„Ù…Ø¨Ù„Øº:* ${price} SDG\nğŸ†” *Ø§Ù„Ø¢ÙŠØ¯ÙŠ:* ${pid}\nğŸ›¡ï¸ *Ø§Ù„ÙˆÙƒÙŠÙ„:* ${ag.options[ag.selectedIndex].text}`;
                window.open(`https://wa.me/${ag.value}?text=${encodeURIComponent(msg)}`);
            });
        };

        function syncData() {
            onValue(ref(db, 'packages'), snap => {
                const lists = { direct: document.getElementById('list-direct'), id: document.getElementById('list-id'), subs: document.getElementById('list-subs') };
                const adm = document.getElementById('adm-pkgs-list');
                Object.values(lists).forEach(l => l.innerHTML = ''); adm.innerHTML = '';
                snap.forEach(c => {
                    const d = c.val(), k = c.key;
                    const h = `
                    <div class="royal-card">
                        <div class="flex justify-between items-start mb-4">
                            <div><h4 class="text-2xl font-black">${d.amount}</h4><p class="text-amber-500 font-bold">${d.price} SDG</p></div>
                            <i class="fas fa-bolt text-amber-500/10 text-4xl"></i>
                        </div>
                        <select id="agent-${k}" class="mb-4 text-[10px] font-bold">
                            <option value="249907760989">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ØªØ¬Ø±</option>
                            <option value="249914178935">ğŸ›¡ï¸ Ù…Ù‡Ù†Ø¯ ÙŠØ§Ø³Ø± Ø¨Ù„ÙˆÙ„Ù‡</option>
                            <option value="0916581517">ğŸ›¡ï¸ Ù…Ø­Ù…Ø¯ Ø§Ù„ØªØ§Ø¬ Ø­Ù…Ø²Ø© Ù…Ø¶ÙˆÙŠ</option>
                            <option value="201550165993">ğŸ‡ªğŸ‡¬ Ù…Ø­Ù…Ø¯ ÙØªØ­ÙŠ Ø­Ù…Ø²Ù‡</option>
                        </select>
                        <input id="pid-${k}" type="number" placeholder="ID Ø§Ù„Ù„Ø§Ø¹Ø¨" class="text-center mb-4 font-black">
                        <button onclick="sendOrder('${d.amount}','${d.price}','${k}')" class="khasm-btn">Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ Ø§Ù„Ø¢Ù† ğŸš€</button>
                    </div>`;
                    if(lists[d.type]) lists[d.type].innerHTML += h;
                    if(user.email.toLowerCase() === MASTER) adm.innerHTML += `<div class="flex justify-between bg-white/5 p-2 rounded text-[10px]"><span>${d.amount}</span><button onclick="remove(ref(db,'packages/${k}'))" class="text-red-500">Ø­Ø°Ù</button></div>`;
                });
            });

            onValue(ref(db, 'orders'), snap => {
                const uView = document.getElementById('user-orders');
                const aView = document.getElementById('adm-orders-view');
                uView.innerHTML = ''; aView.innerHTML = '';
                
                if(snap.numChildren() > lastCount && lastCount !== 0 && (user.email.toLowerCase() === MASTER || STAFF.includes(user.email.toLowerCase()))) {
                    new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3').play();
                }
                lastCount = snap.numChildren();

                snap.forEach(c => {
                    const v = c.val(), k = c.key;
                    if(v.userId === user.uid) {
                        uView.innerHTML += `<div class="royal-card p-4 border-r-4 ${v.status.includes('Ù…ÙƒØªÙ…Ù„')?'border-green-500':'border-amber-500'} flex justify-between"><div><b>${v.amount}</b><br><small class="opacity-40 uppercase text-[9px] font-bold">${v.status}</small></div><div class="text-[10px] font-bold text-amber-500">${v.rating?'â­ '+v.rating:v.pid}</div></div>`;
                        if(v.status === 'âœ… Ù…ÙƒØªÙ…Ù„ (ØªÙ… Ø§Ù„Ø´Ø­Ù†)' && !v.rating && !localStorage.getItem('r_'+k)) {
                            ratingKey = k; document.getElementById('ratingPopup').classList.remove('hidden'); localStorage.setItem('r_'+k, '1');
                        }
                    }
                    if(user.email.toLowerCase() === MASTER || STAFF.includes(user.email.toLowerCase())) {
                        aView.innerHTML += `
                        <div class="royal-card p-5 border-l-4 border-amber-600">
                            <div class="flex justify-between items-start mb-2"><b>ğŸ‘¤ ${v.userName}</b><button onclick="remove(ref(db,'orders/${k}'))" class="text-red-500 opacity-20"><i class="fas fa-trash"></i></button></div>
                            <p class="text-xs font-black">${v.amount} | ID: ${v.pid}</p>
                            <p class="text-[8px] text-amber-500 font-bold mt-1">Ø§Ù„Ù…ÙˆÙƒÙ„: ${v.agent} ${v.rating?' | â­ '+v.rating:''}</p>
                            <div class="flex gap-2 mt-4">
                                <button onclick="updateStatus('${k}','${v.userId}','${v.amount}','âœ… Ù…ÙƒØªÙ…Ù„ (ØªÙ… Ø§Ù„Ø´Ø­Ù†)')" class="status-btn btn-complete">Ù…ÙƒØªÙ…Ù„</button>
                                <button onclick="updateStatus('${k}','${v.userId}','${v.amount}','â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°')" class="status-btn btn-pending">ØªÙ†ÙÙŠØ°</button>
                                <button onclick="updateStatus('${k}','${v.userId}','${v.amount}','âŒ ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨')" class="status-btn btn-error">ÙØ´Ù„</button>
                            </div>
                        </div>`;
                    }
                });
            });
            onValue(ref(db, `users/${user.uid}/stars`), s => { const v = s.val()||0; document.getElementById('starsCount').innerText = v; document.getElementById('pointsLarge').innerText = v; });
        }

        window.setStar = n => { ratingValue = n; const stars = document.getElementById('stars-input').children; for(let i=0; i<5; i++) stars[i].className = i<n?"fas fa-star text-amber-500 cursor-pointer":"fas fa-star text-gray-800 cursor-pointer"; };
        window.submitRating = () => { if(ratingKey)
            update(ref(db, `orders/${ratingKey}`), { rating: ratingValue }); document.getElementById('ratingPopup').classList.add('hidden'); };
        window.pushNewPkg = () => { const t = document.getElementById('add-type').value, a = document.getElementById('add-a').value, p = document.getElementById('add-p').value; if(a && p) push(ref(db, 'packages'), { type: t, amount: a, price: p }); };
        window.redeemPoints = () => { const pid = document.getElementById('pid-redeem').value; if(!pid) return alert("Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…"); get(ref(db, `users/${user.uid}/stars`)).then(s => { const pts = s.val()||0; if(pts>=30) { set(ref(db, `users/${user.uid}/stars`), pts-30); push(ref(db, 'orders'), { userName: user.displayName, userId: user.uid, amount: "60 UC (Ù‡Ø¯ÙŠØ©)", price: "Ù†Ù‚Ø§Ø·", pid: pid, agent: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²", status: 'ğŸ Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù‡Ø¯ÙŠØ©', date: new Date().toLocaleString() }); alert("ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ù‡Ø¯ÙŠØ©!"); } else alert("Ù†Ù‚Ø§Ø·Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠØ©"); }); };
    </script>
</body>
</html>
