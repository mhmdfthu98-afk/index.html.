<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhasmShop | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø®Ù„ÙÙŠØ§Øª */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root {
            --primary-color: #2563eb;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
        }

        body { 
            font-family: 'Cairo', sans-serif; 
            margin: 0; 
            background: #ffffff; 
            color: #1a1a1a;
            scroll-behavior: smooth;
        }

        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ¯Ø±Ø¬Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø£Ø¨ÙŠØ¶ + Ø£Ø­Ù…Ø± + Ø£Ø®Ø¶Ø± + Ø£Ø²Ø±Ù‚) */
        .gradient-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(135deg, 
                rgba(255,255,255,1) 0%, 
                rgba(240,255,244,1) 25%, 
                rgba(255,245,245,1) 50%, 
                rgba(240,247,255,1) 75%);
            background-size: 400% 400%;
            animation: moveGradient 12s ease infinite;
        }

        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ÙƒØ±ÙˆØª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ Ø§Ù„Ø£Ø¨ÙŠØ¶ */
        .glass-white { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(0, 0, 0, 0.08); 
            border-radius: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tab-active { 
            border-bottom: 4px solid var(--primary-color); 
            color: var(--primary-color); 
            font-weight: 900; 
        }

        .product-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ */
        .marquee-container {
            background: linear-gradient(90deg, #1e40af, #3b82f6, #1e40af);
            color: white;
            padding: 10px 0;
            perspective: 1000px;
        }
        .marquee-content {
            display: inline-block;
            transform: rotateX(10deg);
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="gradient-bg"></div>

    <div id="authScreen" class="fixed inset-0 z-[5000] bg-white flex items-center justify-center p-6">
        <div class="max-w-sm w-full text-center">
            <div class="mb-8">
                <h1 class="text-5xl font-black italic tracking-tighter text-blue-700">KHASM<span class="text-red-600">SHOP</span></h1>
                <div class="h-1 w-20 bg-green-500 mx-auto mt-2 rounded-full"></div>
            </div>
            <div class="glass-white p-8">
                <p class="text-gray-500 mb-8 font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                <button onclick="loginGoogle()" class="w-full bg-slate-900 text-white p-5 rounded-2xl font-black flex items-center justify-center gap-4 hover:bg-black transition shadow-2xl">
                    <img src="https://www.google.com/favicon.ico" class="w-6"> Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± GOOGLE
                </button>
            </div>
        </div>
    </div>

    <div id="mainUI" class="hidden">
        <div class="marquee-container shadow-lg">
            <marquee behavior="scroll" direction="right" scrollamount="7">
                ğŸ›¡ï¸ Ø´Ø­Ù† Ø¢Ù…Ù† Ø¨Ù†Ø³Ø¨Ø© 100% | ğŸ’ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·: 30 Ù†Ù‚Ø·Ø© = 60 Ø´Ø¯Ø© Ù…Ø¬Ø§Ù†Ø§Ù‹ | âš¡ Ø³Ø±Ø¹Ø© ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ø¹ ÙƒØ¨Ø§Ø± Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡
            </marquee>
        </div>

        <div class="max-w-2xl mx-auto p-4">
            
            <header class="flex justify-between items-center py-8">
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <img id="userImg" src="" class="w-16 h-16 rounded-2xl border-4 border-white shadow-lg">
                        <div class="absolute -bottom-2 -right-2 bg-green-500 w-5 h-5 rounded-full border-4 border-white"></div>
                    </div>
                    <div>
                        <h2 id="userName" class="font-black text-xl text-slate-800 leading-none">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
                        <div id="walletIDDisp" class="mt-2 text-[11px] font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg italic">#000000</div>
                    </div>
                </div>
                <button onclick="logout()" class="text-gray-300 hover:text-red-500 transition-colors"><i class="fas fa-power-off text-2xl"></i></button>
            </header>

            <section class="glass-white p-8 mb-8 relative overflow-hidden">
                <div class="relative z-10 flex justify-between items-end">
                    <div>
                        <p class="text-[11px] text-gray-400 font-black uppercase tracking-widest mb-2">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªÙˆÙØ±</p>
                        <h3 class="text-5xl font-black text-slate-900"><span id="balance">0</span> <span class="text-sm text-blue-600">SDG</span></h3>
                    </div>
                    <div class="text-left">
                        <p class="text-[11px] text-gray-400 font-black mb-1">Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡</p>
                        <div class="bg-green-100 text-green-700 px-4 py-2 rounded-2xl font-black flex items-center gap-2">
                            <span id="points">0</span> <i class="fas fa-star text-xs"></i>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mt-8">
                    <button onclick="openAgents('recharge')" class="bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-blue-200 hover:bg-blue-700 transition">Ø´Ø­Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</button>
                    <button onclick="openAgents('support')" class="bg-white border-2 border-slate-100 text-slate-700 py-4 rounded-2xl font-black hover:bg-slate-50 transition">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</button>
                </div>
            </section>

            <section id="adminPanel" class="hidden mb-10">
                <div class="bg-red-50 border-2 border-red-100 rounded-[35px] p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="bg-red-500 p-2 rounded-lg text-white"><i class="fas fa-user-shield"></i></div>
                        <h4 class="font-black text-red-600 italic">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h4>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-2xl shadow-sm">
                            <p class="text-xs font-bold text-gray-400 mb-3 uppercase">Ø¥ÙŠØ¯Ø§Ø¹ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø²Ø¨Ø§Ø¦Ù†</p>
                            <input id="targetWID" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø²Ø¨ÙˆÙ†" class="w-full mb-3 p-4 bg-slate-50 rounded-xl outline-none focus:ring-2 ring-red-200 font-bold">
                            <input id="targetAmt" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø´Ø­Ù†Ù‡" class="w-full p-4 bg-slate-50 rounded-xl outline-none font-bold">
                        </div>
                        <button onclick="quickCharge()" class="w-full bg-red-600 text-white font-black py-4 rounded-2xl shadow-xl shadow-red-100">ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù† âœ…</button>
                    </div>
                </div>
            </section>

            <nav class="flex justify-between mb-8 border-b border-gray-100">
                <button onclick="switchTab('direct')" id="tab-direct" class="tab-active flex-1 pb-4 text-sm font-bold">Ø´Ø­Ù† Ù…Ø¨Ø§Ø´Ø±</button>
                <button onclick="switchTab('id')" id="tab-id" class="flex-1 pb-4 text-sm font-bold text-gray-400">Ø¹Ø¨Ø± Ø§Ù„Ø¢ÙŠØ¯ÙŠ</button>
                <button onclick="switchTab('subs')" id="tab-subs" class="flex-1 pb-4 text-sm font-bold text-gray-400">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</button>
                <button onclick="switchTab('redeem')" id="tab-redeem" class="flex-1 pb-4 text-sm font-black text-green-600 italic">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ğŸ</button>
            </nav>

            <div id="productGrid" class="grid grid-cols-2 gap-5">
                </div>

        </div>
    </div>

    <div id="agentModal" class="fixed inset-0 z-[6000] bg-slate-900/40 backdrop-blur-md hidden flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-sm rounded-[40px] p-8 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-gray-300 hover:text-red-500 transition"><i class="fas fa-times-circle text-3xl"></i></button>
            <h3 id="modalTitle" class="text-2xl font-black text-slate-800 mb-8 italic">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
            <div class="space-y-4">
                <a href="https://wa.me/249929281699" target="_blank" class="flex items-center justify-between p-5 bg-slate-50 rounded-3xl border-2 border-transparent hover:border-green-500 hover:bg-green-50 transition group">
                    <div>
                        <p class="font-black text-slate-800">Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù…Ø­Ù…Ø¯</p>
                        <p class="text-[10px] text-gray-400 font-bold">Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù† - Ø±Ø¯ ÙÙˆØ±ÙŠ</p>
                    </div>
                    <i class="fab fa-whatsapp text-3xl text-green-500 group-hover:scale-110 transition"></i>
                </a>
                <a href="https://wa.me/249114175317" target="_blank" class="flex items-center justify-between p-5 bg-slate-50 rounded-3xl border-2 border-transparent hover:border-green-500 hover:bg-green-50 transition group">
                    <div>
                        <p class="font-black text-slate-800">Ø§Ù„ÙˆÙƒÙŠÙ„ Ù…Ù‡Ù†Ø¯ ÙŠØ§Ø³Ø±</p>
                        <p class="text-[10px] text-gray-400 font-bold">Ù‚Ø³Ù… Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„</p>
                    </div>
                    <i class="fab fa-whatsapp text-3xl text-green-500 group-hover:scale-110 transition"></i>
                </a>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, where, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC0jzecEwKgHpxHpTi8Y-_bwwfzVdtgf3E",
            authDomain: "khasmshop.firebaseapp.com",
            projectId: "khasmshop",
            storageBucket: "khasmshop.firebasestorage.app",
            messagingSenderId: "238182001615",
            appId: "1:238182001615:web:d77391030a40a481b440ba"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡Ù… Ø¨Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        const admins = ["mhmdfthu98@gmail.com", "mohnadyasir43@gmail.com", "muhammedaltaj111@gmail.com"];
        
        let userData = null;
        let activeTab = "direct";

        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù…Ù† Ù‡Ù†Ø§)
        const storeItems = [
            // Ø´Ø­Ù† Ù…Ø¨Ø§Ø´Ø±
            { id: 1, cat: 'direct', name: '60 UC', uc: 60, price: 4000, pts: '+2' },
            { id: 2, cat: 'direct', name: '325 UC', uc: 325, price: 20000, pts: '+10' },
            { id: 3, cat: 'direct', name: '660 UC', uc: 660, price: 40000, pts: '+22' },
            { id: 4, cat: 'direct', name: '1800 UC', uc: 1800, price: 100000, pts: '+60' },
            // Ø¹Ø¨Ø± Ø§Ù„Ø§ÙŠØ¯ÙŠ
            { id: 5, cat: 'id', name: '385 UC (Ø¹Ø±Ø¶)', uc: 385, price: 26000, pts: '+12' },
            { id: 6, cat: 'id', name: '720 UC', uc: 720, price: 40000, pts: '+24' },
            // Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ­Ø²Ù…
            { id: 7, cat: 'subs', name: 'Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø±Ø§ÙŠÙ… Ø´Ù‡Ø±', uc: 0, price: 4500, pts: '+1' },
            { id: 8, cat: 'subs', name: 'Ø¨Ø±Ø§ÙŠÙ… Ø¨Ù„Øµ Ø´Ù‡Ø±', uc: 900, price: 45000, pts: '+30' },
            { id: 9, cat: 'subs', name: 'Ø­Ø²Ù…Ø© Ø§Ù„Ù…Ø§ØªØ±ÙŠØ§Ù„', uc: 0, price: 13500, pts: '+6' }
        ];

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainUI').classList.remove('hidden');
                document.getElementById('userName').innerText = user.displayName;
                document.getElementById('userImg').src = user.photoURL;

                // Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                if (admins.includes(user.email.toLowerCase())) {
                    document.getElementById('adminPanel').classList.remove('hidden');
                }

                // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©
                const walletRef = doc(db, "wallets", user.uid);
                const walletSnap = await getDoc(walletRef);
                
                if (walletSnap.exists()) {
                    userData = walletSnap.data();
                } else {
                    userData = { 
                        balance: 0, 
                        points: 0, 
                        walletID: Math.floor(100000 + Math.random() * 900000).toString(),
                        email: user.email 
                    };
                    await setDoc(walletRef, userData);
                }
                updateDisplay();
            } else {
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('mainUI').classList.add('hidden');
            }
        });

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø±Ø¶
        function updateDisplay() {
            document.getElementById('balance').innerText = userData.balance.toLocaleString();
            document.getElementById('points').innerText = userData.points || 0;
            document.getElementById('walletIDDisp').innerText = `Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©: #${userData.walletID}`;

            const grid = document.getElementById('productGrid');
            grid.innerHTML = "";

            if (activeTab === 'redeem') {
                renderRedeemSection(grid);
                return;
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            storeItems.filter(item => item.cat === activeTab).forEach(item => {
                grid.innerHTML += `
                    <div class="product-card glass-white p-6 text-center relative border-transparent border-2 hover:border-blue-200">
                        <span class="absolute top-3 left-3 bg-green-50 text-green-600 text-[9px] px-2 py-0.5 rounded-full font-black">${item.pts} Ù†Ù‚Ø·Ø©</span>
                        <p class="text-[10px] text-gray-400 font-black mb-1 uppercase tracking-tighter">${item.name}</p>
                        <h4 class="text-2xl font-black text-slate-800">${item.price.toLocaleString()}</h4>
                        <p class="text-[10px] text-blue-500 font-black mb-4 uppercase italic">Sudanese Pounds</p>
                        <button onclick="processPurchase(${item.price}, ${item.uc}, '${item.name}')" class="w-full bg-slate-900 text-white text-[10px] font-black py-3 rounded-xl hover:bg-blue-600 transition duration-300">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
                    </div>
                `;
            });
        }

        // Ù‚Ø³Ù… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·
        function renderRedeemSection(grid) {
            grid.classList.remove('grid-cols-2');
            grid.classList.add('grid-cols-1');
            grid.innerHTML = `
                <div class="glass-white p-10 text-center border-green-200 border-2">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-gift text-3xl text-green-600"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-800 mb-2 italic">Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</h3>
                    <p class="text-gray-500 text-sm mb-8">ÙƒÙ„ 30 Ù†Ù‚Ø·Ø© ØªÙ…Ù†Ø­Ùƒ 60 Ø´Ø¯Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ÙÙˆØ±Ø§Ù‹</p>
                    <button onclick="redeemPoints(30, 60)" class="w-full bg-green-600 text-white font-black py-5 rounded-2xl shadow-xl shadow-green-100 hover:scale-95 transition">ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ø´Ø¯Ø§Øª (30 Ù†Ù‚Ø·Ø©) ğŸ</button>
                </div>
            `;
        }

        // Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
        window.processPurchase = async (price, uc, name) => {
            if (userData.balance < price) {
                alert("Ø±ØµÙŠØ¯ Ù…Ø­ÙØ¸ØªÙƒ ØºÙŠØ± ÙƒØ§ÙÙ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø´Ø­Ù† Ù…Ù† Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡.");
                return;
            }
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø´Ø­Ù† ${name}ØŸ`)) {
                const userRef = doc(db, "wallets", auth.currentUser.uid);
                const ptsEarned = Math.floor(uc / 60) * 2;
                await updateDoc(userRef, { 
                    balance: increment(-price), 
                    points: increment(ptsEarned) 
                });
                alert(`ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… Ø¥Ø¶Ø§ÙØ© ${ptsEarned} Ù†Ù‚Ø·Ø© Ù„Ø±ØµÙŠØ¯Ùƒ â­`);
                location.reload();
            }
        };

        // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Ù‚Ø§Ø·
        window.redeemPoints = async (cost, uc) => {
            if (userData.points < cost) {
                alert("Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø§ ØªÙƒÙÙŠ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.");
                return;
            }
            const userRef = doc(db, "wallets", auth.currentUser.uid);
            await updateDoc(userRef, { points: increment(-cost) });
            alert(`Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­. ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ø§Ø³ØªÙ„Ø§Ù… ${uc} Ø´Ø¯Ø©.`);
            location.reload();
        };

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ¯Ø§Ù„
        window.openAgents = (type) => {
            const title = document.getElementById('modalTitle');
            title.innerText = (type === 'support') ? "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ø´ÙƒØ§ÙˆÙ‰" : "Ø´Ø­Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡)";
            document.getElementById('agentModal').classList.remove('hidden');
        };

        window.closeModal = () => {
            document.getElementById('agentModal').classList.add('hidden');
        };

        // Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± - Ø¥ÙŠØ¯Ø§Ø¹ Ø³Ø±ÙŠØ¹
        window.quickCharge = async () => {
            const wid = document.getElementById('targetWID').value;
            const amt = parseFloat(document.getElementById('targetAmt').value);
            
            if (!wid || !amt) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø®Ø§Ù†Ø§Øª.");

            const q = query(collection(db, "wallets"), where("walletID", "==", wid));
            const querySnapshot = await getDocs(q);
            
            if (querySnapshot.empty) {
                alert("Ø®Ø·Ø£: Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….");
                return;
            }

            const targetDoc = querySnapshot.docs[0];
            await updateDoc(doc(db, "wallets", targetDoc.id), { balance: increment(amt) });
            alert(`ØªÙ… Ø¥ÙŠØ¯Ø§Ø¹ ${amt} SDG Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø© #${wid} âœ…`);
            document.getElementById('targetWID').value = "";
            document.getElementById('targetAmt').value = "";
        };

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        window.switchTab = (tab) => {
            activeTab = tab;
            const grid = document.getElementById('productGrid');
            grid.classList.add('grid-cols-2');
            grid.classList.remove('grid-cols-1');
            
            document.querySelectorAll('button[id^="tab-"]').forEach(btn => {
                btn.classList.remove('tab-active', 'text-slate-800');
                btn.classList.add('text-gray-400');
            });
            document.getElementById(`tab-${tab}`).classList.add('tab-active', 'text-slate-800');
            updateDisplay();
        };
        // Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        window.loginGoogle = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth).then(() => location.reload());

    </script>
</body>
</html
