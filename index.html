<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± | EMPROR v6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #0a0a0a; color: white; margin: 0; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        
        /* Ø´Ø±ÙŠØ· Ø¬Ø§Ù†Ø¨ÙŠ (Sidebar) */
        #sidebar { 
            position: fixed; top: 0; right: -300px; width: 300px; height: 100%; 
            background: #111; z-index: 1000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -10px 0 30px rgba(0,0,0,0.5); overflow-y: auto;
        }
        #sidebar.active { right: 0; }
        .overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); display: none; z-index: 999; 
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        .btn-3d {
            background: linear-gradient(145deg, #dc2626, #991b1b);
            box-shadow: 0 4px 0 #7f1d1d, 0 8px 15px rgba(0,0,0,0.3);
            border-radius: 12px; transition: 0.1s;
        }
        .btn-3d:active { transform: translateY(3px); box-shadow: 0 1px 0 #7f1d1d; }

        .nav-item { padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 12px; transition: 0.3s; }
        .nav-item:hover { background: rgba(220, 38, 38, 0.1); color: #ef4444; }

        #bg-canvas { position: fixed; top: 0; left: 0; z-index: -1; width: 100%; height: 100%; opacity: 0.3; }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <aside id="sidebar">
        <div class="p-6 text-center border-b border-white/5">
            <img id="sideUserImg" src="" class="w-20 h-20 rounded-full mx-auto border-4 border-red-600 mb-3 shadow-2xl">
            <h3 id="sideUserName" class="font-black text-sm mb-1">...</h3>
            <div class="bg-yellow-600/20 text-yellow-500 rounded-full py-1 px-4 text-xs font-black border border-yellow-500/30 inline-block">
                â­ <span id="sideUserPoints">0</span> Ù†Ù‚Ø·Ø©
            </div>
        </div>

        <nav class="mt-4">
            <div class="px-6 py-2 text-[10px] text-gray-500 font-bold uppercase tracking-widest">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
            <a href="#" onclick="toggleSidebar()" class="nav-item"><i class="fas fa-shopping-cart"></i> Ù…ØªØ¬Ø± Ø§Ù„Ø´Ø­Ù†</a>
            <a href="#ordersSection" onclick="toggleSidebar()" class="nav-item"><i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§ØªÙŠ</a>
            
            <div id="adminNav" class="hidden">
                <div class="px-6 py-2 mt-4 text-[10px] text-red-500 font-bold uppercase tracking-widest">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ‘‘</div>
                <a href="#" onclick="showAdminSection('orders')" class="nav-item"><i class="fas fa-bell"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</a>
                <a href="#" onclick="showAdminSection('packages')" class="nav-item"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø­Ø²Ù…</a>
                <a href="#" onclick="showAdminSection('stats')" class="nav-item"><i class="fas fa-chart-line"></i> Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</a>
            </div>

            <div class="px-6 py-2 mt-4 text-[10px] text-green-500 font-bold uppercase tracking-widest">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
            <a href="https://wa.me/249907760989" target="_blank" class="nav-item text-xs"><i class="fab fa-whatsapp"></i> Ù…. ÙØªØ­ÙŠ (Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…)</a>
            <a href="https://wa.me/249914178935" target="_blank" class="nav-item text-xs"><i class="fab fa-whatsapp"></i> Ù…Ù‡Ù†Ø¯ ÙŠØ§Ø³Ø± (Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡)</a>
            <a href="https://wa.me/249916581517" target="_blank" class="nav-item text-xs"><i class="fab fa-whatsapp"></i> Ù…Ø­Ù…Ø¯ Ø§Ù„ØªØ§Ø¬ (Ø§Ù„Ø¯Ø¹Ù…)</a>
            <a href="https://wa.me/201550165993" target="_blank" class="nav-item text-xs"><i class="fab fa-whatsapp"></i> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…ØµØ±</a>
        </nav>
    </aside>

    <header class="p-5 flex justify-between items-center glass sticky top-0 z-[500]">
        <button onclick="toggleSidebar()" class="text-2xl text-white focus:outline-none">
            <i class="fas fa-bars"></i>
        </button>
        <div class="font-black text-2xl italic">EMPROR<span class="text-red-600">98</span></div>
        <div class="w-10"></div> </header>

    <main class="p-4 max-w-6xl mx-auto">
        
        <div id="userStatsHeader" class="hidden grid grid-cols-2 gap-4 mb-8">
            <div class="glass p-5 rounded-3xl text-center border-b-4 border-yellow-600">
                <p class="text-[10px] text-gray-500 mb-1">Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                <h4 id="mainPoints" class="text-2xl font-black text-yellow-500">0</h4>
            </div>
            <div class="glass p-5 rounded-3xl text-center border-b-4 border-red-600">
                <p class="text-[10px] text-gray-500 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø·Ù„Ø¨Ø§ØªÙƒ</p>
                <h4 id="mainOrdersCount" class="text-2xl font-black text-red-500">0</h4>
            </div>
        </div>

        <div id="adminContent" class="hidden mb-12 animate-fade-in">
            </div>

        <div id="shopSection" class="hidden">
            <h2 class="text-xl font-black mb-6 italic border-r-4 border-red-600 pr-3">Ø­Ø²Ù… Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h2>
            <div id="packagesGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-16"></div>
        </div>

        <div id="ordersSection" class="hidden pt-10">
            <h2 class="text-xl font-black mb-6 italic border-r-4 border-green-600 pr-3">Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§ØªÙŠ (Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ‚Ø¯ÙŠÙ…Ø©)</h2>
            <div id="userOrdersList" class="space-y-4"></div>
        </div>

        <div id="loginSection" class="glass p-16 rounded-[4rem] text-center my-10 border-white/10 shadow-2xl max-w-lg mx-auto">
            <h1 class="text-5xl font-black mb-6 italic">EMPROR<span class="text-red-600">98</span></h1>
            <p class="text-gray-500 mb-10 text-xs leading-relaxed">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø£ÙˆÙ„Ù‰. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù†Ù‚Ø§Ø·Ùƒ ÙˆØ·Ù„Ø¨Ø§ØªÙƒ.</p>
            <button onclick="login()" class="bg-white text-black w-full py-5 rounded-3xl font-black flex items-center justify-center gap-3 hover:bg-red-600 hover:text-white transition-all shadow-xl">
                <img src="https://www.google.com/favicon.ico" class="w-6"> Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø¬ÙˆØ¬Ù„
            </button>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, set, get, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC0jzecEwKgHpxHpTi8Y-_bwwfzVdtgf3E",
            authDomain: "khasmshop.firebaseapp.com",
            databaseURL: "https://khasmshop-default-rtdb.firebaseio.com",
            projectId: "khasmshop",
            storageBucket: "khasmshop.firebasestorage.app",
            messagingSenderId: "238182001615",
            appId: "1:238182001615:web:4c7ddea335df2111b440ba"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const SUPER_ADMIN = "mhmdfthu98@gmail.com";

        window.toggleSidebar = () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
        };

        window.login = () => signInWithPopup(auth, provider);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('shopSection').classList.remove('hidden');
                document.getElementById('ordersSection').classList.remove('hidden');
                document.getElementById('userStatsHeader').classList.remove('hidden');
                
                // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§ÙŠØ¯ Ø¨Ø§Ø±
                document.getElementById('sideUserName').innerText = user.displayName;
                document.getElementById('sideUserImg').src = user.photoURL;

                if (user.email === SUPER_ADMIN) {
                    document.getElementById('adminNav').classList.remove('hidden');
                }
                
                loadUserData(user.uid);
                loadPackages();
                loadUserOrders(user.uid);
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù†Ù‚Ø§Ø· ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª)
        function loadUserData(uid) {
            onValue(ref(db, `users/${uid}/points`), s => {
                const pts = s.val() || 0;
                document.getElementById('sideUserPoints').innerText = pts;
                document.getElementById('mainPoints').innerText = pts;
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø²Ù… Ù„Ù„Ø²Ø¨Ø§Ø¦Ù†
        function loadPackages() {
            onValue(ref(db, 'packages'), (s) => {
                const grid = document.getElementById('packagesGrid'); grid.innerHTML = '';
                s.forEach(c => {
                    const d = c.val();
                    grid.innerHTML += `<div class="glass p-6 rounded-[2.5rem] text-center relative group">
                        <h2 class="text-3xl font-black italic mb-2">${d.amount} UC</h2>
                        <p class="text-sm text-gray-500 mb-6">${d.price} SDG</p>
                        <input id="id-${c.key}" type="number" placeholder="ID Ø§Ù„Ù„Ø§Ø¹Ø¨" class="w-full p-4 mb-2 rounded-2xl bg-black border border-white/10 text-center font-bold outline-none focus:border-red-600">
                        <button onclick="orderNow('${d.amount}', '${d.price}', '${c.key}')" class="w-full btn-3d py-4 text-xs font-black">Ø´Ø­Ù† ÙÙˆØ±ÙŠ âš¡</button>
                    </div>`;
                });
            });
        }

        window.orderNow = (amount, price, key) => {
            const pid = document.getElementById(`id-${key}`).value;
            if(!pid) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ ID!");
            const user = auth.currentUser;
            const orderId = "#EM-" + Math.floor(Math.random()*9999);
            push(ref(db, 'orders'), {
                amount, price, pid, userId: user.uid, userName: user.displayName,
                orderId, date: new Date().toLocaleString('ar-EG'), status: "â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"
            });
            window.open(`https://wa.me/249916581517?text=Ø·Ù„Ø¨ Ø´Ø­Ù† ${amount} UC Ù„Ù„Ù€ ID: ${pid}`);
        };

        function loadUserOrders(uid) {
            onValue(ref(db, 'orders'), (s) => {
                const list = document.getElementById('userOrdersList'); list.innerHTML = '';
                let count = 0;
                s.forEach(c => {
                    if (c.val().userId === uid) {
                        count++;
                        const d = c.val();
                        list.innerHTML += `<div class="p-5 bg-white/5 rounded-3xl border-r-2 border-red-600 flex justify-between items-center">
                            <div><p class="text-[8px] text-gray-500">${d.orderId}</p><p class="font-bold text-sm">${d.amount} UC</p><p class="text-[9px] text-gray-400">${d.date}</p></div>
                            <span class="text-[10px] font-black italic text-green-500">${d.status}</span>
                        </div>`;
                    }
                });
                document.getElementById('mainOrdersCount').innerText = count;
            });
        }

        // Ø®Ù„ÙÙŠØ© Ø¨Ø³ÙŠØ·Ø©
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        function animate() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "rgba(220,38,38,0.2)";
            ctx.beginPath(); ctx.arc(100, 100, 50, 0, Math.PI*2); ctx.fill();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
