<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KHASM SHOP | Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø®ØµÙ…</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
body { font-family: 'Cairo', sans-serif; background: #0b0f1a; color: white; overflow-x: hidden; }
.glass-card { background: rgba(30,41,59,0.8); border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); padding:1rem; box-shadow:0 10px 30px rgba(0,0,0,0.5);}
.khasm-btn { background: linear-gradient(90deg,#22c55e,#16a34a); color:white; border-radius:12px; text-align:center; font-weight:bold; transition:0.3s; cursor:pointer;}
.khasm-btn:hover { filter:brightness(1.2); transform:scale(1.02);}
.page.hidden { display:none; }
.admin-sub.hidden { display:none; }
.marquee { white-space: nowrap; overflow: hidden; position: relative; background: #16a34a; color:white; padding:10px 0; font-weight:bold; font-size:12px; }
.marquee div { display: inline-block; padding-left: 100%; animation: marquee 30s linear infinite; }
@keyframes marquee { 0% { transform: translate(0,0);} 100% { transform: translate(-100%,0);} }
</style>
</head>
<body>

<div class="marquee"><div id="hexAds">âš¡ Ø´Ø­Ù† ÙÙˆØ±ÙŠ ÙˆØ¢Ù…Ù† â€¢ ğŸ’ Ù†Ù‚Ø§Ø· Ø°ÙƒÙŠÙ‡ â€¢ ğŸ¦ Ø§Ø¯ÙØ¹ Ø¨Ù€ "Ø¨Ù†ÙƒÙƒ" Ø£Ùˆ "Ù…Ø§ÙŠ ÙƒØ§Ø´" â€¢ ğŸ¤ ÙˆÙƒÙ„Ø§Ø¡ Ù…Ø¹ØªÙ…Ø¯ÙˆÙ† â€¢ ğŸ›°ï¸ Ø³ØªØ§Ø±Ù„ÙŠÙ†Ùƒ â€¢ ğŸ›¡ï¸ Ø¶Ù…Ø§Ù† ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨</div></div>

<header class="bg-black/80 border-b border-white/10 p-4 sticky top-0 z-[1000] flex justify-between items-center">
  <div class="text-2xl font-black text-green-400 italic">KHASM SHOP</div>
  <div class="flex gap-2">
    <div id="userLabel" class="text-[10px] font-bold bg-gray-800 px-3 py-1 rounded-full">...</div>
    <div id="userPointsDisplay" class="text-[10px] font-bold bg-yellow-400 text-black px-3 py-1 rounded-full">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
  </div>
</header>

<nav class="flex justify-around bg-black/70 p-4 border-b border-white/10 text-xs font-bold text-gray-400 shadow-sm">
  <div onclick="showPage('shop')" class="cursor-pointer hover:text-green-400"><i class="fas fa-store ml-1"></i> Ø§Ù„Ù…ØªØ¬Ø±</div>
  <div onclick="showPage('myOrders')" class="cursor-pointer hover:text-green-400"><i class="fas fa-box ml-1"></i> Ø·Ù„Ø¨Ø§ØªÙŠ</div>
  <div id="adminTab" onclick="showPage('admin')" class="cursor-pointer text-red-500 hidden"><i class="fas fa-crown ml-1"></i> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
</nav>

<main class="p-4 max-w-4xl mx-auto mb-20">
  <!-- Ù…ØªØ¬Ø± -->
  <div id="shopPage" class="page">
    <div id="promos" class="flex gap-3 overflow-x-auto py-4 mb-6"></div>
    <h2 class="font-black mb-4 text-green-400">Ø¨Ø§Ù‚Ø§Øª UC ÙˆØ§Ù„Ø¬ÙˆØ§Ù‡Ø± âš¡</h2>
    <div id="packagesGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
  </div>

  <!-- Ø·Ù„Ø¨Ø§ØªÙŠ -->
  <div id="myOrdersPage" class="page hidden">
    <h2 class="font-black mb-4 text-green-400">ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ</h2>
    <div id="userOrdersList" class="space-y-3"></div>
  </div>

  <!-- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
  <div id="adminPage" class="page hidden">
    <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
      <button onclick="showAdminTab('orders')" class="bg-green-600 text-white px-4 py-2 rounded-lg text-[10px] font-bold">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      <button id="managePkgBtn" onclick="showAdminTab('pkg')" class="bg-gray-800 px-4 py-2 rounded-lg text-[10px] font-bold hidden">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
      <button id="managePromoBtn" onclick="showAdminTab('promo')" class="bg-gray-800 px-4 py-2 rounded-lg text-[10px] font-bold hidden">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</button>
    </div>

    <div id="admin-orders" class="admin-sub">
      <div id="allOrdersList" class="space-y-4"></div>
    </div>

    <div id="admin-pkg" class="admin-sub hidden">
      <div class="glass-card mb-4">
        <h3 class="font-bold mb-2">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
        <input id="pName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©" class="w-full mb-2 p-2 border rounded text-sm">
        <input id="pAmount" type="text" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© (60 Ø´Ø¯Ø©)" class="w-full mb-2 p-2 border rounded text-sm">
        <input id="pPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¬Ù†ÙŠØ©" class="w-full mb-2 p-2 border rounded text-sm">
        <button onclick="addNewPkg()" class="w-full khasm-btn py-2 text-sm">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø±</button>
      </div>
      <div id="adminPkgList" class="space-y-2"></div>
    </div>

    <div id="admin-promo" class="admin-sub hidden">
      <div class="glass-card mb-4">
        <input id="proText" type="text" placeholder="Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø³Ø±ÙŠØ¹" class="w-full mb-2 p-2 border rounded text-sm">
        <button onclick="addNewPromo()" class="w-full khasm-btn py-2 text-sm">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
      </div>
      <div id="adminPromoList" class="space-y-2"></div>
    </div>
  </div>
</main>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¯ÙØ¹ -->
<div id="paymentModal" class="fixed inset-0 bg-black/70 z-[2000] hidden flex items-center justify-center p-4">
  <div class="bg-gray-900 rounded-3xl p-6 w-full max-w-sm text-white">
    <h3 class="font-black mb-2 text-green-400">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡</h3>
    <div class="bg-black/50 p-3 rounded-2xl mb-4 text-[11px] border border-gray-700">
      <b>ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ù„ØªØ­ÙˆÙŠÙ„:</b><br>
      Ø¨Ù†ÙƒÙƒ: 4845744 (Ø§Ù…Ù†Ù‡ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ)<br>
      Ù…Ø§ÙŠ ÙƒØ§Ø´: 401793722 (Ù…Ø­Ù…Ø¯ ÙØªØ­ÙŠ)
    </div>
    <input id="ingameName" type="text" placeholder="Ø§Ø³Ù…Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©" class="w-full p-3 border rounded-xl mb-2 outline-none bg-gray-800">
    <input id="transId" type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ" class="w-full p-3 border rounded-xl mb-4 outline-none bg-gray-800">
    <div class="flex gap-2">
      <button onclick="closePayment()" class="flex-1 bg-gray-800 py-3 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
      <button onclick="confirmOrder()" class="flex-1 khasm-btn py-3 font-bold">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </div>
</div>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ -->
<div id="loginOverlay" class="fixed inset-0 bg-black/90 z-[9999] flex flex-col items-center justify-center p-6">
  <h1 class="text-3xl font-black text-green-400 mb-8 italic">KHASM SHOP</h1>
  <button onclick="login()" class="w-full max-w-xs bg-green-600 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-4">
    <i class="fab fa-google"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬ÙˆØ¬Ù„
  </button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, set, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC0jzecEwKgHpxHpTi8Y-_bwwfzVdtgf3E",
  authDomain: "khasmshop.firebaseapp.com",
  databaseURL: "https://khasmshop-default-rtdb.firebaseio.com",
  projectId: "khasmshop",
  storageBucket: "khasmshop.firebasestorage.app",
  messagingSenderId: "238182001615",
  appId: "1:238182001615:web:4c7ddea335df2111b440ba"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const ADMIN_EMAIL = "mhmdfthu98@gmail.com";
let currentUser = null;
let selectedPackage = null;

onAuthStateChanged(auth, user => {
  if(user){
    currentUser=user;
    document.getElementById('loginOverlay').style.display='none';
    setupPermissions(user.email);
    loadData();
  }else{
    document.getElementById('loginOverlay').style.display='flex';
  }
});

window.login = ()=>signInWithPopup(auth,provider);

function setupPermissions(email){
  if(email===ADMIN_EMAIL){
    document.getElementById('adminTab').classList.remove('hidden');
    document.getElementById('managePkgBtn').classList.remove('hidden');
    document.getElementById('managePromoBtn').classList.remove('hidden');
    document.getElementById('userLabel').innerText="Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ‘‘";
  }else{
    document.getElementById('userLabel').innerText="Ø¹Ù…ÙŠÙ„ Ù…Ù…ÙŠØ² â­";
  }
}

window.showPage=id=>{document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));document.getElementById(id+'Page').classList.remove('hidden');};
window.showAdminTab=id=>{document.querySelectorAll('.admin-sub').forEach(s=>s.classList.add('hidden'));document.getElementById('admin-'+id).classList.remove('hidden');};

window.addNewPkg=()=>{
  const name=document.getElementById('pName').value;
  const amount=document.getElementById('pAmount').value;
  const price=document.getElementById('pPrice').value;
  if(name&&amount&&price){push(ref(db,'packages'),{name,amount,price});alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬!');}
};

window.addNewPromo=()=>{
  const text=document.getElementById('proText').value;
  if(text) push(ref(db,'promos'),{text});
};

window.openPayment=(amount,price,name,i)=>{
  const idInput=document.getElementById(`id-${i}`).value;
  if(!idInput)return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ID Ø§Ù„Ù„Ø§Ø¹Ø¨!");
  selectedPackage={amount,price,name,pid:idInput};
  document.getElementById('paymentModal').classList.remove('hidden');
};
window.closePayment=()=>document.getElementById('paymentModal').classList.add('hidden');

window.confirmOrder=()=>{
  const igName=document.getElementById('ingameName').value;
  const trans=document.getElementById('transId').value;
  if(!igName||!trans) return alert('Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„!');
  const orderId="EM-"+Math.floor(1000+Math.random()*9000);
  const orderData={
    ...selectedPackage,
    orderId,
    ingameName:igName,
    transactionId:trans,
    userId:currentUser.uid,
    userName:currentUser.displayName,
    status:"â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
    date:new Date().toLocaleString('ar-EG')
  };
  push(ref(db,'orders'),orderData);
  const waMsg=`ğŸ‘‘ *Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø®ØµÙ… Ù„Ù„Ø´Ø­Ù†* ğŸ‘‘\n\n*Ø§Ù„Ø²Ø¨ÙˆÙ†:* ${currentUser.displayName}\n*Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:* #${orderId}\n*Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:* Ø´Ø­Ù† ${selectedPackage.amount}\n*ID Ø§Ù„Ù„Ø§Ø¹Ø¨:* ${selectedPackage.pid}\n*Ø§Ù„Ø³Ø¹Ø±:* ${selectedPackage.price} Ø¬.Ø³\n\nâœ… *ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¢Ù† Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.*`;
  window.open(`https://wa.me/249916581517?text=${encodeURIComponent(waMsg)}`);
  closePayment();
  alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
};

function loadData(){
  onValue(ref(db,`users/${currentUser.uid}/points`),s=>document.getElementById('userPointsDisplay').innerText=`Ø§Ù„Ù†Ù‚Ø§Ø·: ${s.val()||0}`);
  onValue(ref(db,'packages'),s=>{
    const grid=document.getElementById('packagesGrid');
    const adminL=document.getElementById('adminPkgList');
    grid.innerHTML='';adminL.innerHTML='';
    s.forEach(c=>{
      const d=c.val();
      grid.innerHTML+=`<div class="glass-card text-center">
        <h3 class="text-xl font-black mb-2">${d.amount}</h3>
        <p class="text-gray-300 mb-2">${d.name}</p>
        <p class="text-green-400 font-bold mb-3">${d.price} Ø¬.Ø³</p>
        <input id="id-${c.key}" type="text" placeholder="ID Ø§Ù„Ù„Ø§Ø¹Ø¨" class="w-full p-3 border rounded mb-2 bg-gray-800 text-white text-center">
        <button onclick="openPayment('${d.amount}','${d.price}','${d.name}','${c.key}')" class="w-full khasm-btn py-2">Ø´Ø­Ù† Ø§Ù„Ø¢Ù† âš¡</button>
      </div>`;
      adminL.innerHTML+=`<div class="flex justify-between items-center p-2 glass-card text-xs"><span>${d.amount} (${d.price} Ø¬.Ø³)</span><button onclick="remove(ref(db,'packages/${c.key}'))" class="text-red-500"><i class="fas fa-trash"></i></button></div>`;
    });
  });
  onValue(ref(db,'orders'),s=>{
    const uL=document.getElementById('userOrdersList');
    const aL=document.getElementById('allOrdersList');
    uL.innerHTML='';aL.innerHTML='';
    s.forEach(c=>{
      const d=c.val();
      const card=`<div class="glass-card flex justify-between items-center">
        <div><p class="font-black text-sm">${d.amount}</p><p class="text-[9px] text-gray-400">#${d.orderId}</p></div>
        <span class="text-xs ${d.status.includes('ØªÙ…')?'text-green-400':'text-yellow-400'}">${d.status}</span>
      </div>`;
      if(d.userId===currentUser.uid) uL.innerHTML+=card;
      if(currentUser.email===ADMIN_EMAIL) aL.innerHTML+=`<div class="glass-card p-2 mb-2 text-xs">
        <div class="mb-1"><b>${d.userName}</b> | ID:${d.pid} | Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:${d.transactionId}</div>
        <div class="flex gap-1">
          <button onclick="updateStatus('${c.key}','âœ… Ù…ÙƒØªÙ…Ù„','${d.userId}',${d.price})" class="bg-green-500 px-2 rounded text-[9px]">ØªÙ…</button>
          <button onclick="updateStatus('${c.key}','âŒ ÙØ´Ù„','','')" class="bg-red-500 px-2 rounded text-[9px]">ÙØ´Ù„</button>
          <button onclick="remove(ref(db,'orders/${c.key}'))" class="bg-gray-500 px-2 rounded text-[9px]">Ø­Ø°Ù</button>
        </div>
      </div>`;
    });
  });
  onValue(ref(db,'promos'),s=>{
    const pDiv=document.getElementById('promos');
    const aDiv=document.getElementById('adminPromoList');
    pDiv.innerHTML='';aDiv.innerHTML='';
    s.forEach(c=>{
      pDiv.innerHTML+=`<div class="min-w-[220px] bg-green-600 p-4 rounded-2xl text-[10px] font-bold shadow-lg">ğŸ”¥ ${c.val().text}</div>`;
      aDiv.innerHTML+=`<div class="flex justify-between p-2 glass-card text-xs"><span>${c.val().text}</span><button onclick="remove(ref(db,'promos/${c.key}'))" class="text-red-500"><i class="fas fa-trash"></i></button></div>`;
    });
  });
}
</script>
</body>
        </html>
