<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhasmShop | Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; margin: 0; background: #020617; color: white; overflow-x: hidden; }
        
        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ®Ù…Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .royal-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
        }
        .stars { position: absolute; width: 100%; height: 100%; background: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.3; animation: moveBg 50s linear infinite; }
        @keyframes moveBg { from { background-position: 0 0; } to { background-position: 1000px 1000px; } }

        /* Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        .marquee-3d {
            background: linear-gradient(90deg, #1e40af, #3b82f6); color: #fbbf24; padding: 15px 0;
            transform: perspective(1000px) rotateX(10deg); box-shadow: 0 15px 35px rgba(0,0,0,0.7);
            border-bottom: 3px solid #fbbf24; font-weight: 900; z-index: 50; position: relative;
        }

        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 35px; }
        .btn-royal { background: linear-gradient(to right, #fbbf24, #f59e0b); color: black; font-weight: 900; transition: 0.3s; }
        .btn-royal:hover { transform: scale(1.05); shadow: 0 0 20px #fbbf24; }
    </style>
</head>
<body>

    <div class="royal-bg"><div class="stars"></div></div>

    <div id="authScreen" class="fixed inset-0 z-[1000] bg-slate-950 flex items-center justify-center p-6">
        <div class="glass w-full max-w-sm p-10 text-center border-yellow-400/20">
            <h1 class="text-4xl font-black mb-2 text-white italic">KHASM<span class="text-yellow-400">SHOP</span></h1>
            <p class="text-gray-400 text-sm mb-10">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„ÙØ®Ø§Ù…Ø©</p>
            <button onclick="loginGoogle()" class="w-full bg-white text-black p-5 rounded-2xl font-black flex items-center justify-center gap-4 hover:bg-gray-200 transition">
                <img src="https://www.google.com/favicon.ico" class="w-6"> Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google
            </button>
        </div>
    </div>

    <div id="mainUI" class="hidden">
        <div class="marquee-3d">
            <marquee behavior="scroll" direction="right" scrollamount="8">
                âœ¨ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ Ø§Ù„Ù…Ù„ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† âœ¨ | Ø®ØµÙˆÙ…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 12% Ù„Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù…Ø§Ø³ÙŠØ© | Ø´Ø­Ù† ÙÙˆØ±ÙŠ ÙˆØ¢Ù…Ù† ğŸ›¡ï¸
            </marquee>
        </div>

        <div class="max-w-md mx-auto p-4">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center gap-3">
                    <img id="userImg" src="" class="w-12 h-12 rounded-full border-2 border-yellow-400 shadow-lg shadow-yellow-400/20">
                    <div>
                        <p id="userName" class="font-black text-lg text-white leading-none">ØªØ­Ù…ÙŠÙ„...</p>
                        <p id="rankBadge" class="text-yellow-400 text-[10px] font-bold mt-1 uppercase tracking-widest italic"></p>
                    </div>
                </div>
                <button onclick="logout()" class="text-gray-500 hover:text-red-500 transition"><i class="fas fa-power-off text-xl"></i></button>
            </div>

            <div class="glass p-5 mb-6 border-r-4 border-yellow-400 flex justify-between items-center">
                <div>
                    <p class="text-[10px] text-gray-500 font-bold mb-1">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</p>
                    <p id="orderStatus" class="text-sm font-black text-white italic">ğŸ” Ø§Ø¨Ø¯Ø£ Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ø´Ø­Ù† Ø§Ù„Ø¢Ù†</p>
                </div>
                <div class="text-yellow-400 animate-pulse"><i class="fas fa-box-open text-2xl"></i></div>
            </div>

            <div class="glass p-8 mb-10 relative overflow-hidden bg-gradient-to-br from-white/5 to-transparent">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <p class="text-[10px] text-gray-400 uppercase tracking-[3px] mb-1">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                        <h2 class="text-5xl font-black text-white"><span id="balance">0</span> <span class="text-sm text-yellow-400">SDG</span></h2>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-gray-400 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©</p>
                        <p id="walletID" class="text-xl font-black text-yellow-400 tracking-widest italic">------</p>
                    </div>
                </div>
                <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden">
                    <div id="progressBar" class="bg-yellow-400 h-full w-0 transition-all duration-1000"></div>
                </div>
            </div>

            <div id="agentPanel" class="hidden glass p-6 mb-10 border-2 border-yellow-400/40 shadow-xl shadow-yellow-400/5">
                <h3 class="text-yellow-400 font-black mb-5 flex items-center gap-3 text-lg">
                    <i class="fas fa-bolt"></i> Ù„ÙˆØ­Ø© Ø´Ø­Ù† Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
                </h3>
                <input id="targetID" type="text" placeholder="Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø²Ø¨ÙˆÙ†" class="w-full mb-4 p-5 rounded-3xl bg-white/5 border border-white/10 text-center font-black text-white outline-none focus:border-yellow-400 transition">
                <input id="amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø´Ø­Ù†Ù‡" class="w-full mb-6 p-5 rounded-3xl bg-white/5 border border-white/10 text-center font-black text-white outline-none focus:border-yellow-400 transition">
                <button onclick="agentCharge()" class="w-full btn-royal p-5 rounded-3xl shadow-lg">ØªØ£ÙƒÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</button>
            </div>

            <h3 class="text-2xl font-black mb-6 flex items-center gap-3 italic">
                <span class="w-2 h-10 bg-yellow-400 rounded-full shadow-[0_0_15px_#fbbf24]"></span>
                Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø´Ø­Ù†
            </h3>
            <div id="products" class="grid grid-cols-2 gap-5"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, where, getDocs, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC0jzecEwKgHpxHpTi8Y-_bwwfzVdtgf3E",
            authDomain: "khasmshop.firebaseapp.com",
            projectId: "khasmshop",
            storageBucket: "khasmshop.firebasestorage.app",
            messagingSenderId: "238182001615",
            appId: "1:238182001615:web:d77391030a40a481b440ba"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const agents = ["mohnadyasir43@gmail.com", "muhammedaltaj111@gmail.com", "mhmdfthu98@gmail.com"];
        let userProfile = null;

        const items = [
            { id: 1, name: "60 UC", uc: 60, price: 4000 },
            { id: 2, name: "325 UC", uc: 325, price: 18500 },
            { id: 3, name: "660 UC", uc: 660, price: 36000 },
            { id: 4, name: "1800 UC", uc: 1800, price: 95000 }
        ];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainUI').classList.remove('hidden');
                document.getElementById('userName').innerText = user.displayName;
                document.getElementById('userImg').src = user.photoURL;

                if (agents.includes(user.email.toLowerCase())) {
                    document.getElementById('agentPanel').classList.remove('hidden');
                }

                const ref = doc(db, "wallets", user.uid);
                const snap = await getDoc(ref);
                if (snap.exists()) {
                    userProfile = snap.data();
                } else {
                    userProfile = { balance: 0, totalUC: 0, rank: "Ø¨Ø±ÙˆÙ†Ø²ÙŠ", walletID: Math.floor(100000 + Math.random() * 900000).toString() };
                    await setDoc(ref, userProfile);
                }
                renderStore();
            } else {
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('mainUI').classList.add('hidden');
            }
        });

        function renderStore() {
            const ranks = [
                { name: "Ù…Ø§Ø³ÙŠ", disc: 0.12, min: 7400 },
                { name: "Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ", disc: 0.09, min: 4400 },
                { name: "Ø°Ù‡Ø¨ÙŠ", disc: 0.06, min: 2400 },
                { name: "ÙØ¶ÙŠ", disc: 0.03, min: 900 },
                { name: "Ø¨Ø±ÙˆÙ†Ø²ÙŠ", disc: 0, min: 0 }
            ];
            const currentRank = ranks.find(r => userProfile.totalUC >= r.min);
            
            document.getElementById('balance').innerText = userProfile.balance.toLocaleString();
            document.getElementById('walletID').innerText = userProfile.walletID;
            document.getElementById('rankBadge').innerText = `Ø±ØªØ¨Ø© Ø§Ù„Ù…Ù„Ùƒ: ${currentRank.name}`;
            
            const pGrid = document.getElementById('products');
            pGrid.innerHTML = "";
            items.forEach(i => {
                const finalPrice = i.price * (1 - currentRank.disc);
                pGrid.innerHTML += `
                    <div class="glass p-5 text-center border-white/5 hover:border-yellow-400/50 transition duration-500 group">
                        <p class="text-[10px] text-gray-500 font-bold mb-2">${i.name}</p>
                        <p class="text-2xl font-black text-white group-hover:text-yellow-400 transition">${finalPrice.toLocaleString()}</p>
                        <p class="text-[10px] text-yellow-400 italic mb-4">SDG</p>
                        <button onclick="buyNow(${i.price}, ${i.uc})" class="w-full btn-royal py-2 rounded-xl text-[10px] shadow-lg">Ø´Ø­Ù† Ø¢Ù…Ù†</button>
                    </div>`;
            });
        }

        window.loginGoogle = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth);
        
        window.buyNow = async (p, uc) => {
            if (userProfile.balance < p) return alert("Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ! Ø§Ø´Ø­Ù† Ù…Ù† Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡.");
            if (confirm("Ù‡Ù„ ØªØ¤ÙƒØ¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù† Ø§Ù„ÙÙˆØ±ÙŠØŸ")) {
                const ref = doc(db, "wallets", auth.currentUser.uid);
                await updateDoc(ref, { balance: increment(-p), totalUC: increment(uc) });
                document.getElementById('orderStatus').innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ø¯Ø§Øª Ù„Ù„Ù€ ID...";
                setTimeout(() => { document.getElementById('orderStatus').innerText = "âœ… ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­! ØªÙÙ‚Ø¯ Ø­Ø³Ø§Ø¨Ùƒ."; location.reload(); }, 4000);
            }
        };

        window.agentCharge = async () => {
            const id = document.getElementById('targetID').value;
            const cash = parseFloat(document.getElementById('amount').value);
            if (id.length !== 6 || isNaN(cash)) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!");
            const q = query(collection(db, "wallets"), where("walletID", "==", id));
            const s = await getDocs(q);
            if (s.empty) return alert("Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
            await updateDoc(doc(db, "wallets", s.docs[0].id), { balance: increment(cash) });
            alert("ØªÙ… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­!");
        };
    </script>
</body>
                </html>
