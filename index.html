<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhasmShop | Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…Ù„ÙƒÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        body { font-family: 'Cairo', sans-serif; background: #fff; overflow-x: hidden; }

        /* Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© ÙØ®Ù…Ø© */
        .royal-bg {
            position: fixed; inset: 0; z-index: -1;
            background: linear-gradient(135deg, #ffffff 0%, #f0fff4 30%, #fff5f5 60%, #fffdf0 100%);
            background-size: 400% 400%; animation: gradientMove 15s ease infinite;
        }
        @keyframes gradientMove { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }

        /* Ø§Ù†ØªØ±Ùˆ Ø§ÙØªØªØ§Ø­ÙŠ ÙØ®Ù… */
        #intro {
            position: fixed; inset: 0; z-index: 9999; background: #000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            animation: fadeOut 1s ease 3s forwards;
        }
        .logo-anim { font-size: 4rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px #2563eb; animation: zoomPulse 2s ease-in-out infinite; }
        @keyframes zoomPulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.7; } }
        @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }

        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); border: 1px solid rgba(0,0,0,0.05); border-radius: 30px; }
        .tab-active { border-bottom: 4px solid #2563eb; color: #2563eb; font-weight: 900; }
        .order-card { border-right: 5px solid #2563eb; }
        
        /* Ø¥Ø¹Ù„Ø§Ù† Ø«Ù„Ø§Ø«ÙŠ ÙØ®Ù… */
        .marquee-3d {
            background: linear-gradient(90deg, #16a34a, #dc2626, #eab308);
            color: white; padding: 12px 0; font-weight: 900; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

    <div id="intro">
        <div class="logo-anim italic">KHASM<span class="text-blue-500">SHOP</span></div>
        <div class="mt-4 text-gray-400 font-bold tracking-widest">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙØ®Ø§Ù…Ø©...</div>
    </div>

    <div class="royal-bg"></div>

    <div id="authScreen" class="fixed inset-0 z-[5000] bg-white/90 backdrop-blur-xl flex items-center justify-center p-6 hidden">
        <div class="glass w-full max-w-sm p-10 text-center shadow-2xl">
            <h1 class="text-4xl font-black text-slate-800 mb-2 italic">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h1>
            <p class="text-gray-500 text-sm mb-10 font-bold">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google Ù„Ù„Ø¨Ø¯Ø¡</p>
            <button onclick="login()" class="w-full bg-blue-600 text-white p-5 rounded-2xl font-black flex items-center justify-center gap-4 hover:bg-blue-700 transition shadow-xl">
                <i class="fab fa-google text-xl"></i> Ø¯Ø®ÙˆÙ„ Ù‚ÙˆÙ‚Ù„ Ø¨Ù„Ø§ÙŠ
            </button>
        </div>
    </div>

    <div id="mainUI" class="hidden">
        <div class="marquee-3d"><marquee>ğŸ’¥ Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ø±ØªØ¨: ÙØ¶ÙŠ 3% | Ø°Ù‡Ø¨ÙŠ 6% | Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ 9% | Ù…Ø§Ø³ÙŠ 12% ğŸ’¥ Ø§Ø´Ø­Ù† Ø§Ù„Ø¢Ù† ÙˆØ§Ø±ÙØ¹ Ø±ØªØ¨ØªÙƒ ğŸ’¥</marquee></div>

        <div class="max-w-2xl mx-auto p-4">
            <header class="flex justify-between items-center py-6">
                <div class="flex items-center gap-4">
                    <img id="uImg" class="w-16 h-16 rounded-2xl border-4 border-white shadow-lg">
                    <div>
                        <h2 id="uName" class="font-black text-xl text-slate-800">..</h2>
                        <div class="flex gap-2 items-center">
                            <span id="uRank" class="bg-amber-700 text-white text-[10px] px-2 py-0.5 rounded-lg font-bold">Ø¨Ø±ÙˆÙ†Ø²ÙŠ</span>
                            <span id="uID" class="text-blue-600 font-bold text-xs italic">#000000</span>
                        </div>
                    </div>
                </div>
                <button onclick="toggleSidebar()" class="text-slate-800 text-2xl"><i class="fas fa-bars"></i></button>
            </header>

            <section class="glass p-8 mb-8 bg-white/50 relative overflow-hidden">
                <div class="flex justify-between items-end relative z-10">
                    <div>
                        <p class="text-[10px] text-gray-400 font-black uppercase mb-1">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</p>
                        <h2 class="text-5xl font-black text-slate-900"><span id="uBal">0</span> <span class="text-sm text-blue-600">SDG</span></h2>
                    </div>
                    <div class="text-left">
                        <p class="text-[10px] text-gray-400 font-black mb-1">Ù†Ù‚Ø§Ø·Ùƒ</p>
                        <h2 class="text-2xl font-black text-green-600"><span id="uPts">0</span> â­</h2>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mt-8">
                    <button onclick="openAgents('Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯')" class="bg-blue-600 text-white py-4 rounded-2xl font-black text-xs shadow-lg">Ø´Ø­Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</button>
                    <button onclick="openAgents('Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ')" class="bg-green-600 text-white py-4 rounded-2xl font-black text-xs shadow-lg">Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨</button>
                </div>
            </section>

            <nav class="flex gap-6 mb-8 border-b border-gray-100 overflow-x-auto no-scrollbar font-black text-sm">
                <button onclick="setTab('store')" id="t-store" class="tab-active pb-4 shrink-0">Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ</button>
                <button onclick="setTab('orders')" id="t-orders" class="text-gray-400 pb-4 shrink-0">Ø·Ù„Ø¨Ø§ØªÙŠ</button>
                <button onclick="setTab('points')" id="t-points" class="text-gray-400 pb-4 shrink-0">Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
                <button id="adminBtn" onclick="setTab('admin')" class="hidden text-red-600 pb-4 shrink-0 italic">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© âš™ï¸</button>
            </nav>

            <div id="view-store" class="grid grid-cols-2 gap-4"></div>

            <div id="view-orders" class="hidden space-y-4"></div>

            <div id="view-admin" class="hidden space-y-6">
                <div class="bg-red-50 p-6 rounded-[30px] border-2 border-red-100">
                    <h3 class="font-black text-red-600 mb-4">Ø¥ÙŠØ¯Ø§Ø¹ Ø±ØµÙŠØ¯ ÙŠØ¯ÙˆÙŠ</h3>
                    <input id="admWID" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©" class="w-full p-4 rounded-xl mb-2 outline-none">
                    <input id="admAmt" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" class="w-full p-4 rounded-xl mb-4 outline-none">
                    <button onclick="adminDeposit()" class="w-full bg-red-600 text-white font-black py-4 rounded-xl">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</button>
                </div>
                <div id="allOrders" class="space-y-4">
                    <h3 class="font-black text-slate-800">ÙƒÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†:</h3>
                    </div>
            </div>
        </div>
    </div>

    <div id="buyModal" class="fixed inset-0 z-[6000] bg-black/60 backdrop-blur-md hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[35px] p-8 relative shadow-2xl">
            <h3 id="buyTitle" class="font-black text-xl mb-6 italic text-center text-blue-600">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø­Ù†</h3>
            <div class="space-y-4">
                <input id="pPlayerID" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¢ÙŠØ¯ÙŠ (ID)" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-center">
                <input id="pPlayerName" placeholder="Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-center">
                <div class="p-4 bg-blue-50 rounded-2xl text-center">
                    <p class="text-[10px] font-bold text-blue-400 uppercase">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</p>
                    <p class="font-black text-blue-700">Ù…Ø­ÙØ¸Ø© Ø®ØµÙ… Ø´ÙˆØ¨</p>
                </div>
                <button id="confirmBtn" class="w-full bg-slate-900 text-white font-black py-5 rounded-2xl shadow-xl">ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù† âœ…</button>
                <button onclick="closeModals()" class="w-full text-gray-400 font-bold py-2">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div id="agentModal" class="fixed inset-0 z-[7000] bg-black/60 backdrop-blur-md hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[35px] p-8 relative shadow-2xl text-right">
            <h3 class="font-black text-xl mb-6 italic text-center text-green-600">Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙˆÙ†</h3>
            <div class="space-y-3">
                <a href="https://wa.me/201550165993" class="block p-4 bg-slate-50 rounded-2xl border-2 border-transparent hover:border-green-500 transition">
                    <p class="font-black">Ù…Ø­Ù…Ø¯ ÙØªØ­ÙŠ Ø­Ù…Ø²Ù‡ (Ù…ØµØ±)</p>
                    <p class="text-[10px] text-gray-400">+20 15 50165993</p>
                </a>
                <a href="https://wa.me/249914178935" class="block p-4 bg-slate-50 rounded-2xl border-2 border-transparent hover:border-green-500 transition">
                    <p class="font-black">Ù…Ø­Ù…Ø¯ Ø§Ù„ØªØ§Ø¬ Ø­Ù…Ø²Ù‡ (Ø§Ù„Ø³ÙˆØ¯Ø§Ù†)</p>
                    <p class="text-[10px] text-gray-400">+249 91 417 8935</p>
                </a>
                <a href="https://wa.me/249916581517" class="block p-4 bg-slate-50 rounded-2xl border-2 border-transparent hover:border-green-500 transition">
                    <p class="font-black">Ù…Ù‡Ù†Ø¯ ÙŠØ§Ø³Ø± Ø¨Ù„ÙˆÙ„Ù‡ (Ø§Ù„Ø³ÙˆØ¯Ø§Ù†)</p>
                    <p class="text-[10px] text-gray-400">+249 91 658 1517</p>
                </a>
                <a href="https://wa.me/249907760989" class="block p-4 bg-blue-600 text-white rounded-2xl text-center font-black">Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ØªØ¬Ø±</a>
            </div>
            <button onclick="closeModals()" class="w-full mt-4 text-gray-300 font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-white z-[8000] shadow-2xl translate-x-[-100%] transition-transform duration-500 p-8">
        <button onclick="toggleSidebar()" class="mb-10 text-2xl text-gray-300"><i class="fas fa-times"></i></button>
        <div class="mb-8">
            <h2 class="text-2xl font-black text-blue-600 mb-2 italic">Ù…Ù† Ù†Ø­Ù†ØŸ</h2>
            <div class="h-1 w-10 bg-red-500 rounded-full"></div>
        </div>
        <p class="text-slate-600 font-bold leading-relaxed italic">
            "ÙÙŠ Ø®ØµÙ… Ø´ÙˆØ¨ØŒ Ù„Ø§ Ù†Ø¨ÙŠØ¹ Ù…Ø¬Ø±Ø¯ Ø´Ø¯Ø§ØªØŒ Ù†Ø­Ù† Ù†ØµÙ†Ø¹ Ø§Ù„ÙØ®Ø§Ù…Ø©. Ù…ØªØ¬Ø±Ù†Ø§ ØµÙÙ…Ù… Ø¨Ù„Ù…Ø³Ø© Ù…Ù† Ø§Ù„Ø±Ù‚ÙŠ Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø·Ù…ÙˆØ­Ø§ØªÙƒÙ… ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨. Ù†Ø­Ù† Ù†Ø¤Ù…Ù† Ø£Ù† Ø§Ù„Ø²Ø¨ÙˆÙ† Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ Ø±Ù‚Ù…ØŒ Ø¨Ù„ Ø´Ø±ÙŠÙƒ ÙÙŠ Ù†Ø¬Ø§Ø­Ù†Ø§ØŒ ÙˆÙ„Ø°Ù„Ùƒ ÙˆÙØ±Ù†Ø§ Ù„ÙƒÙ… Ù†Ø¸Ø§Ù… Ø±ØªØ¨ Ù…Ù„ÙƒÙŠ ÙˆØ®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ ØªÙ„ÙŠÙ‚ Ø¨Ù…Ù‚Ø§Ù…ÙƒÙ… Ø§Ù„Ø±ÙÙŠØ¹."
        </p>
        <div class="mt-10 pt-10 border-t border-gray-100">
            <p class="text-[10px] text-gray-400 font-black uppercase">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø±</p>
            <p class="font-black text-slate-800">ROYAL V5.0</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, onSnapshot, query, where, orderBy, increment, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyC0jzecEwKgHpxHpTi8Y-_bwwfzVdtgf3E", authDomain: "khasmshop.firebaseapp.com", projectId: "khasmshop", storageBucket: "khasmshop.firebasestorage.app", messagingSenderId: "238182001615", appId: "1:238182001615:web:d77391030a40a481b440ba" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const admins = ["mhmdfthu98@gmail.com", "mohnadyasir43@gmail.com", "muhammedaltaj111@gmail.com"];

        let uData = null;
        let currentTab = 'store';

        const storeItems = [
            { id: '1', n: '60 US', p: 4000, uc: 60, pts: 2 },
            { id: '2', n: '325 US', p: 20000, uc: 325, pts: 10 },
            { id: '3', n: '660 US', p: 40000, uc: 660, pts: 22 },
            { id: '4', n: '1800 US', p: 100000, uc: 1800, pts: 60 },
            { id: '5', n: '3850 US', p: 200000, uc: 3850, pts: 128 },
            { id: '6', n: '8100 US', p: 400000, uc: 8100, pts: 270 }
        ];

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª ---
        function getRankDetails(totalUC) {
            if (totalUC >= 7400) return { name: 'Ù…Ø§Ø³ÙŠ', disc: 0.12, class: 'bg-purple-600' };
            if (totalUC >= 4400) return { name: 'Ø¨Ù„Ø§ØªÙŠÙ†ÙŠ', disc: 0.09, class: 'bg-blue-500' };
            if (totalUC >= 2400) return { name: 'Ø°Ù‡Ø¨ÙŠ', disc: 0.06, class: 'bg-amber-400' };
            if (totalUC >= 900) return { name: 'ÙØ¶ÙŠ', disc: 0.03, class: 'bg-slate-400' };
            return { name: 'Ø¨Ø±ÙˆÙ†Ø²ÙŠ', disc: 0, class: 'bg-amber-800' };
        }

        onAuthStateChanged(auth, async (user) => {
            setTimeout(() => {
                if (user) {
                    document.getElementById('authScreen').classList.add('hidden');
                    document.getElementById('mainUI').classList.remove('hidden');
                    initUser(user);
                } else {
                    document.getElementById('authScreen').classList.remove('hidden');
                }
            }, 3500);
        });

        async function initUser(user) {
            const ref = doc(db, "users", user.uid);
            onSnapshot(ref, (snap) => {
                if (snap.exists()) {
                    uData = snap.data();
                    updateHeader();
                    renderStore();
                    if (admins.includes(user.email.toLowerCase())) {
                        document.getElementById('adminBtn').classList.remove('hidden');
                        loadAdminOrders();
                    }
                } else {
                    const newU = { name: user.displayName, email: user.email, balance: 0, points: 0, totalUC: 0, walletID: Math.floor(100000 + Math.random() * 900000).toString(), img: user.photoURL };
                    setDoc(ref, newU);
                }
            });
            loadUserOrders(user.uid);
        }

        function updateHeader() {
            const rank = getRankDetails(uData.totalUC || 0);
            document.getElementById('uName').innerText = uData.name;
            document.getElementById('uImg').src = uData.img;
            document.getElementById('uBal').innerText = uData.balance.toLocaleString();
            document.getElementById('uPts').innerText = uData.points || 0;
            document.getElementById('uID').innerText = `#${uData.walletID}`;
            document.getElementById('uRank').innerText = rank.name;
            document.getElementById('uRank').className = `text-white text-[10px] px-2 py-0.5 rounded-lg font-bold ${rank.class}`;
        }

        function renderStore() {
            const grid = document.getElementById('view-store');
            const rank = getRankDetails(uData.totalUC || 0);
            grid.innerHTML = "";
            storeItems.forEach(i => {
                const finalPrice = i.p * (1 - rank.disc);
                grid.innerHTML += `
                    <div class="glass p-6 text-center relative border-2 border-transparent hover:border-blue-400 transition shadow-sm">
                        <span class="absolute top-2 left-2 text-[8px] bg-green-100 text-green-600 px-2 py-0.5 rounded-full font-black">+${i.pts} â­</span>
                        <p class="text-[10px] text-gray-400 font-bold mb-1">${i.n}</p>
                        <p class="text-xl font-black text-slate-800">${finalPrice.toLocaleString()}</p>
                        <button onclick="openBuyModal('${i.id}', ${finalPrice}, ${i.uc}, ${i.pts})" class="w-full bg-slate-900 text-white text-[10px] py-3 rounded-xl mt-4 font-black">Ø´Ø­Ù† Ø§Ù„Ø¢Ù†</button>
                    </div>`;
            });
        }

        window.openBuyModal = (id, price, uc, pts) => {
            if (uData.balance < price) return alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ! Ø§Ø´Ø­Ù† Ù…Ù† Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡.");
            document.getElementById('buyModal').classList.remove('hidden');
            document.getElementById('confirmBtn').onclick = () => createOrder(price, uc, pts, id);
        };

        async function createOrder(price, uc, pts, itemID) {
            const pid = document.getElementById('pPlayerID').value;
            const pName = document.getElementById('pPlayerName').value;
            if (!pid || !pName) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");

            const order = {
                uid: auth.currentUser.uid,
                uName: uData.name,
                walletID: uData.walletID,
                playerID: pid,
                playerName: pName,
                item: storeItems.find(x => x.id === itemID).n,
                price: price,
                status: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°',
                date: new Date().toLocaleString('ar-EG')
            };

            await addDoc(collection(db, "orders"), order);
            await updateDoc(doc(db, "users", auth.currentUser.uid), {
                balance: increment(-price),
                points: increment(pts),
                totalUC: increment(uc)
            });

            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
            closeModals();
        }

        function loadUserOrders(uid) {
            const q = query(collection(db, "orders"), where("uid", "==", uid));
            onSnapshot(q, (snap) => {
                const div = document.getElementById('view-orders');
                div.innerHTML = snap.empty ? '<p class="text-center text-gray-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</p>' : '';
                snap.forEach(doc => {
                    const o = doc.data();
                    const color = o.status === 'Ù…ÙƒØªÙ…Ù„' ? 'green' : (o.status === 'ÙØ´Ù„' ? 'red' : 'blue');
                    div.innerHTML += `
                        <div class="glass p-5 order-card" style="border-right-color: ${color}">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-black text-slate-800">${o.item}</h4>
                                <span class="text-[10px] font-black text-${color}-600 bg-${color}-50 px-2 py-1 rounded-lg">${o.status}</span>
                            </div>
                            <p class="text-[10px] text-gray-400 font-bold">${o.date}</p>
                            <p class="text-xs font-bold mt-2 text-slate-500 italic">ID: ${o.playerID} | ${o.playerName}</p>
                        </div>`;
                });
            });
        }

        async function loadAdminOrders() {
            onSnapshot(collection(db, "orders"), (snap) => {
                const div = document.getElementById('allOrders');
                div.innerHTML = "";
                snap.forEach(d => {
                    const o = d.data();
                    div.innerHTML += `
                        <div class="glass p-4 text-xs border-l-4 border-red-500">
                            <p><b>Ø§Ù„Ø²Ø¨ÙˆÙ†:</b> ${o.uName} (#${o.walletID})</p>
                            <p><b>Ø§Ù„Ø·Ù„Ø¨:</b> ${o.item}</p>
                            <p><b>ID Ø§Ù„Ù„Ø¹Ø¨Ø©:</b> ${o.playerID} (${o.playerName})</p>
                            <div class="mt-2 flex gap-1">
                                <button onclick="updateStatus('${d.id}', 'Ù…ÙƒØªÙ…Ù„')" class="bg-green-500 text-white px-2 py-1 rounded">Ù…ÙƒØªÙ…Ù„</button>
                                <button onclick="updateStatus('${d.id}', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°')" class="bg-blue-500 text-white px-2 py-1 rounded">Ø¬Ø§Ø±ÙŠ</button>
                                <button onclick="updateStatus('${d.id}', 'ÙØ´Ù„')" class="bg-red-500 text-white px-2 py-1 rounded">ÙØ´Ù„</button>
                            </div>
                        </div>`;
                    });
            });
        }

        window.updateStatus = async (id, s) => { await updateDoc(doc(db, "orders", id), { status: s }); alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«!"); };
        
        window.adminDeposit = async () => {
            const wid = document.getElementById('admWID').value;
            const amt = parseFloat(document.getElementById('admAmt').value);
            const q = query(collection(db, "users"), where("walletID", "==", wid));
            const s = await getDocs(q);
            if (s.empty) return alert("Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
            await updateDoc(doc(db, "users", s.docs[0].id), { balance: increment(amt) });
            alert("ØªÙ… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹!");
        };

        window.setTab = (t) => {
            ['store', 'orders', 'points', 'admin'].forEach(v => {
                document.getElementById(`view-${v}`)?.classList.add('hidden');
                document.getElementById(`t-${v}`)?.classList.remove('tab-active');
                document.getElementById(`t-${v}`)?.classList.add('text-gray-400');
            });
            document.getElementById(`view-${t}`).classList.remove('hidden');
            document.getElementById(`t-${t}`).classList.add('tab-active');
            document.getElementById(`t-${t}`).classList.remove('text-gray-400');
        };

        window.openAgents = (title) => { document.getElementById('agentModal').classList.remove('hidden'); };
        window.closeModals = () => { document.getElementById('buyModal').classList.add('hidden'); document.getElementById('agentModal').classList.add('hidden'); };
        window.toggleSidebar = () => { const s = document.getElementById('sidebar'); s.style.transform = s.style.transform === 'translateX(0%)' ? 'translateX(-100%)' : 'translateX(0%)'; };
        window.login = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth).then(() => location.reload());

    </script>
</body>
</html
